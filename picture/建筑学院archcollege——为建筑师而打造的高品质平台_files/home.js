window.__ROOT__=window.location.protocol+"//"+window.location.host+"/";$(function(){if($(".fixed_wrp")[0]){$(".fixed_wrp").width($(".rt_main").outerWidth());$(window).resize(function(event){$(".fixed_wrp").width($(".rt_main").outerWidth());});}
if($("#nav_wrp")[0]){var $f=$("#nav_iframe");var f=$f[0];var fTimer=null;var bLoadBtn=false;function iframeInitLoad(){$f.load(function(){$f.show();$("#dropdown_iframe_wrp").css("min-height","auto");setIframeHeight();menuStatistics();})
f.src=$f.attr("data-src");}
function setIframeHeight(){clearInterval(fTimer);fTimer=setInterval(function(){if(f&&f.contentWindow.document.documentElement){var subWrp=f.contentWindow.document.getElementById("class_wrp");if(subWrp&&subWrp.offsetHeight!==null)
f.height=f.contentWindow.document.getElementById("class_wrp").offsetHeight;}},30);}
var menuTimer;var faceTimer;var mobileTimer;$("#nav_wrp .menu,#dropdown_iframe_wrp").hover(function(){clearTimeout(menuTimer);menuTimer=setTimeout(function(){$("#nav_wrp .menu .wrp_arrow").show();$("#dropdown_iframe_wrp").slideDown(function(){$(this).height("auto");if(!bLoadBtn){if(window.sessionStorage&&window.sessionStorage.getItem("iframe_dropdown")){$f.attr("data-src",$f.attr("data-cache")||"/iframe_dropdown_cache");}
iframeInitLoad();bLoadBtn=true;}else{setIframeHeight();}})},200)},function(){clearTimeout(menuTimer);menuTimer=setTimeout(function(){clearInterval(fTimer);$("#nav_wrp .menu .wrp_arrow").fadeOut();$("#dropdown_iframe_wrp").fadeOut();},500)})
$("#nav_wrp .face,#nav_wrp .center_pldown").hover(function(){clearTimeout(faceTimer);faceTimer=setTimeout(function(){$("#nav_wrp .face .wrp_arrow").show();$("#nav_wrp .center_pldown").slideDown(function(){$(this).height("auto");})},200)},function(){clearTimeout(faceTimer);faceTimer=setTimeout(function(){$("#nav_wrp .face .wrp_arrow").fadeOut();$("#nav_wrp .center_pldown").fadeOut();},500)})
$("#nav_wrp .mobile,#nav_wrp .mobile .mouseover_pop").hover(function(){clearTimeout(mobileTimer);mobileTimer=setTimeout(function(){$("#nav_wrp .mobile .wrp_arrow").show();$("#nav_wrp .mobile .mouseover_pop").slideDown();},200)},function(){clearTimeout(faceTimer);mobileTimer=setTimeout(function(){$("#nav_wrp .mobile .wrp_arrow").fadeOut();$("#nav_wrp .mobile .mouseover_pop").fadeOut();},500)})
if($("img.head_lazy")[0]){$("img.head_lazy").lazyload({placeholder:"http://www.archcollege.com/images/lazy_default.jpg",effect:"fadeIn",event:"mouseover"});}
$("#class_wrp .parent_cl li").mouseover(function(){var index=$(this).index();$(this).addClass('active').siblings().removeClass('active');$("#class_wrp .child_cl").hide().eq(index).show().find(".head_lazy").trigger('mouseover');});var curSearchTab=$(".toggle_search a.active").index()||0;$(".toggle_search a").click(function(){var index=$(this).index();curSearchTab=index;$(this).addClass('active').siblings().removeClass('active');if(index===0){$(".search_wrp .entry_text input").attr("placeholder","我是学院的百宝袋");}else{$(".search_wrp .entry_text input").attr("placeholder","课程或讲师");}})
$("#nav_wrp .search,#m_nav .m_search").click(function(){$("#search_lock").show();var eInner=$("#search_lock").find(".search_wrp");if(eInner[0].offsetHeight>=document.documentElement.clientHeight){eInner.css({marginTop:0});}else{eInner.css({marginTop:(document.documentElement.clientHeight-$(".search_lock .search_wrp").outerHeight())/2+"px"});}
setTimeout(function(){$("#search_lock").addClass('search_lock_active');},50)})
$(".search_lock").click(function(){$("#search_lock").removeClass('search_lock_active');setTimeout(function(){$("#search_lock").hide();},400)})
$(".search_lock .search_wrp").click(function(e){e.stopPropagation();}).submit(function(event){return false;});$("#search_lock .close_search").click(function(){var input=$(this).siblings("input")[0];if(/^\s*$/.test(input.value)){alert("请输入关键词");}else{this.subModule=curSearchTab?"course":"article";if(curSearchTab==0){window.location.href="/home.php?m=Index&type=article&a=search&key="+input.value;}else{window.location.href="/home.php?m=Index&type=course&a=search&key="+input.value;}}})
$("#search_lock input[type=text]").keyup(function(e){if(e.keyCode!==13)return;$("#search_lock .close_search").trigger('click');});navBarClass();$(window).scroll(navBarClass);function navBarClass(){var iW_t=$(window).scrollTop();if(iW_t<20){$("#nav_wrp").removeClass('nav_wrp_active');}else{$("#nav_wrp").addClass('nav_wrp_active');}}
(function(){var btn=true;var ltBar=$("#fixed_ltbar");if(ltBar[0]){$(window).scroll(function(event){var footer=$("#index_footer");var slider=$(".slider");var iW_t=$(window).scrollTop();var iD_sh=document.documentElement.scrollHeight;var iD_ch=document.documentElement.clientHeight;var iB_h=slider[0]?slider.outerHeight():0;var iF_h=footer[0]?footer.outerHeight():0;var iH=ltBar.outerHeight();var iT=ltBar[0].offsetTop;if((iW_t<iB_h-iT+100&&slider[0])||(iW_t>iD_sh-(iD_ch+iF_h-iT)&&footer[0])){if(!btn)return;ltBar.stop().animate({left:-100,opacity:0});btn=false;}else{if(btn)return;ltBar.stop().animate({left:18,opacity:1});btn=true;}});$(window).trigger('scroll');}})();}
(function(){var html=$(document.documentElement);var clickBlack;function showClickBlack(target){clickBlack=$("<div style='z-index:10000000;position:absolute; top:0; left:0; height:100%; width:100%;'></div>");clickBlack.click(function(){html.removeClass('open_menu');html.removeClass('open_user');if($("#m_nav .m_user")[0])
$("#m_nav .m_user")[0].btn=false;$("#m_nav .m_menu")[0].btn=false;clickBlack.remove();})
clickBlack.appendTo(document.body);}
$("#m_nav .m_menu").click(function(event){if(!this.btn){showClickBlack("#m_nav .m_menu");html.addClass('open_menu').removeClass('open_user');if($("#m_nav .m_user")[0]){$("#m_nav .m_user")[0].btn=false;}}else{html.removeClass('open_menu');}
this.btn=!this.btn;});$("#m_nav .m_user").click(function(event){if(!this.btn){showClickBlack("#m_nav .m_user");html.addClass('open_user').removeClass('open_menu');$("#m_nav .m_menu")[0].btn=false;}else{html.removeClass('open_user');}
this.btn=!this.btn;});}());$(".package_fltbtn .close").click(function(e){e.stopPropagation();$(this).parent().hide();})
window.onbeforeunload=onbeforeunload_handler;});(function(){$(".glb_statistics").click(function(){var This=this;if(This.sbtn)return false;This.sbtn=true;var sStatistics=$(this).attr("data-statistics");try{var oData=JSON.parse(sStatistics);}catch(e){throw "data-statistics 参数格式错误";}
$.get('/home.php?m=Statistics&a=add',oData,function(){This.sbtn=false;});});$("#search_lock .close_search").click(function(e){var input=$(this).siblings("input")[0];var searchBtn=this;if(searchBtn.sbtn)return false;searchBtn.sbtn=true;if(!/^\s*$/.test(input.value)){$.get('/home.php?m=Statistics&a=add',{module:"navigation_search",sub_module:searchBtn.subModule,target_name:input.value},function(){searchBtn.sbtn=false;});}});$("#search_lock .key_blk a").click(function(event){var searchBtn=$("#search_lock .close_search")[0];if(searchBtn.sbtn)return false;searchBtn.sbtn=true;$.get('/home.php?m=Statistics&a=add',{module:"navigation_search",sub_module:"hot_key",target_name:$(this).text()},function(){searchBtn.sbtn=false;});});$("#nav_wrp .nav li:eq(2) a,#nav_wrp .nav li:eq(3) a, #nav_wrp .nav li.face a").click(function(){var This=this;var index=$(This).parent().index();var module;if(this.sbtn)return;this.sbtn=true;if(index==2){module="navigation_course";}else if(index==3){module="navigation_travel";}else{module="navigation_user";}
$.get('/home.php?m=Statistics&a=add',{module:module,target_name:$(this).text()},function(){This.sbtn=false;});})
if($(".atcl_email_point")[0]){$(".rt_main .atcl_email").click(function(){$("#fixed_ltbar .ic_email").trigger('click');})}})();function courseJoin(){var course_id=$("#course_id").val();var type=$("#course_type").val();$.ajax({url:"/home.php?m=Course&a=courseJoin",type:"post",data:{course_id:course_id,type:type,},dataType:"json",success:function(data,text){if(data.code){alert('报名成功');location.reload();}else{alert('报名失败，请重新报名');}}})}
function menuStatistics(){$("#nav_iframe").contents().find(".child_cl a").click(function(){if($("#nav_iframe")[0].sbtn)return;$("#nav_iframe")[0].sbtn=true;$.get('/home.php?m=Statistics&a=add',{module:"navigation_menu",target_name:$(this).text(),target_href:$(this).attr("href")},function(){$("#nav_iframe")[0].sbtn=false;});})}
function showPoint(num){hidePoints();$(".playing-wrap .play_main .point").show().find(".text").html("学习完该课程可以获得"+num+"元奖学金~");clearTimeout(arguments.callee.timer);arguments.callee.timer=setTimeout(function(){$(".playing-wrap .play_main .point").fadeOut();},5000)}
function showPointIng(num){hidePoints();$(".playing-wrap .play_main .point_ing").show().find(".text").html("还剩"+num+"%便可达成学习指标并领取奖学金");}
function showPointOver(num){hidePoints();$(".playing-wrap .play_main .point_over").show().find(".text").html("已完成该课学习指标并获得"+num+"元奖学金");clearTimeout(arguments.callee.timer);arguments.callee.timer=setTimeout(function(){$(".playing-wrap .play_main .point_over").fadeOut();},5000)}
function hidePoints(selector){if(selector){$(".playing-wrap .play_main "+selector).hide();}else{$(".playing-wrap .play_main .point_over").hide();$(".playing-wrap .play_main .point_ing").hide();$(".playing-wrap .play_main .point").hide();}}
var end_show=0;function checkShip(){var course_id=$("#course_id").val();var sub_course_id=$("#sub_course_id").val();var real_watch_time=polyvPlayer.j2s_stayInVideoTime();var course_type=$("#course_type").val();$.ajax({url:"/home.php?m=Course&a=courseDetail",type:"post",data:{course_id:course_id,sub_course_id:sub_course_id,time:real_watch_time,course_type:course_type},dataType:"json",success:function(data,text){if(data.is_show){if(end_show==0){showPointOver(data.return_money)}
end_show=1;}},error:function(XMLHttpRequest,textStatus,errorThrown){console.log(XMLHttpRequest);console.log(textStatus);console.log(errorThrown);}});}
function onbeforeunload_handler(){addPlayLog();}
function addPlayLog(){var start_time=polyvPlayer.j2s_getCurrentTime();var all_time=polyvPlayer.j2s_getDuration();var real_watch_time=polyvPlayer.j2s_stayInVideoTime();var type=$("#course_type").val();var course_id=$("#course_id").val();var sub_course_id=$("#sub_course_id").val();$.ajax({url:"/home.php?m=Learn&a=learnLog",type:"post",data:{course_id:course_id,sub_course_id:sub_course_id,start_time:start_time,all_time:all_time,type:type,real_watch_time:real_watch_time},success:function(data,text){}});}
function s2j_onVideoPause(){addPlayLog();}
notLoginShow();function notLoginShow(){if(ajaxCheckLoginPure())
$("#not-login").remove();else
$("#not-login").show();}
var SITE_WIDTH=915;function changeMyTab(e){jQuery(".my-tab-wrap .tab-item").removeClass("selected");jQuery(e).addClass("selected");index=jQuery(".my-tab-wrap .tab-item").index(jQuery(e));jQuery(e).parents(".my-tab-wrap").siblings(".my-tab-content-wrap").children(".tab-content").addClass("notshow");jQuery(e).parents(".my-tab-wrap").siblings(".my-tab-content-wrap").children(".tab-content").eq(index).removeClass("notshow");}
function goToUrl(url){window.location=url;}
function openUrl(url){window.open(url);}
function beforeReply(id,name){$("#content").val("");$("#parent_id").val(id);$("#content").attr('placeholder',name);$("#content").focus();$("html,body").animate({scrollTop:$(".all-comment-list-wrap").offsetTop},1000);}
function commentNow(url){var content=$.trim($("#content").val());if(content==""){alert("请填写评论内容！");return false;}
$.ajax({async:false,url:"/home.php?m=Member&a=commentNow",type:'post',data:{id:$("#id").val(),parent_id:$("#parent_id").val(),content:content},dataType:"json",success:function(data,text){if(data){var html='<dd class="clear">';html+='<span class="person fl"><img class="face lazy" src="'+(data.imagePath==""?$("#template_directory").val()+"/img/Default_Avatar.png":data.imagePath)+'"/></span>';html+='<div class="cont">';html+='<div class="feature">';html+='<span class="origin">'+data.name+'</span>';html+=data.commentDate;html+='<a href="javascript:void(0)" onclick="beforeReply('+data.comment_id+',\'回复@'+data.name+'\');">回复</a>';html+='</div>';html+='<p class="text">';if(data.toUserName!=""){html+='回复 <a href="javascript:;">'+data.toUserName+'</a>: ';}
html+=data.content+'</p>';html+='</div>';if(data.toUserName!=""){html+='<dl class="reply"><dd class="clear"><span class="person fl">';html+='<img class="face lazy" src="'+(data.parentImagePath==""?$("#template_directory").val()+"/img/Default_Avatar.png":data.parentImagePath)+'"/></span>';html+='<div class="cont"><div class="feature"><span class="origin">';html+=data.toUserName+'</span>';html+=data.parentCommentDate;html+='<a href="javascript:void(0)" onclick="beforeReply('+data.parent_id+',\'回复@'+data.toUserName+'\');">回复</a>';html+='</div>';html+='<p class="text">'+data.parent_content+'</p>';html+='</div>';}
html+='</dd>';$(".all-comment-list-wrap dt").html(data.count+"条评论");$(".ic_comment span").html(data.count);$(".all-comment-list-wrap dt").after(html);$("#content").val("");$("#content").attr('placeholder','');$("#parent_id").val("");}
else{alert(data.message);}}});}
function getTeacherCataId(){var cataid="";$.ajax({async:false,url:"home.php?m=Teacher&a=getTeacherCataId",type:"post",success:function(data,text){if(data.cataId){cataid=data.cataId;}else{alert('数据获取错误,视频无法上传,请联系官方');}}});return cataid;}
function imgChanged(dataInJson){dataInJson=dataInJson||{};var fileElementId=dataInJson.fileElementId||"img_up";var pager=$("#pager").val();$.ajaxFileUpload({url:"home.php?m=Common&a=ajaxUploadImage",secureuri:false,dataType:"json",fileElementId:fileElementId,success:function(data){if(data.msgCode=='000'){var imagePath=data.result;var html="<a href='"+imagePath+"' target='_blank'><img src='"+imagePath+"' class='image-limit' /></a>";var um=ue[0];html=um.getContent()+html;um.setContent(html);$("#works_image_path").val(imagePath);}else if(data.msgCode=="001"){alert(data.result);}},error:function(){alert("error");}});}
function commonImgChanged(dataInJson){dataInJson=dataInJson||{};var fileElementId=dataInJson.fileElementId||"img_up";var savePath=dataInJson.savePath||"imgPath";var imgSize=dataInJson.imgSize||"imgSize";var allowExts=dataInJson.allowExts||"imgUpload";var targetHdn=dataInJson.targetHdn||"";var input=$("#"+fileElementId).get(0);if(input&&typeof input.files=="object"&&input.files[0]){if(!input.files[0].type.match("image")){alert("上传错误,请上传有效的图片格式");input.value="";return;}else if(input.files[0].size>2*1024*1024){alert("上传图片不得大于2M");input.value="";return;}}
var parent;if(targetHdn=="#id_card_image_path"){parent=$(".upimg").eq(0).addClass('uping');}else if(targetHdn=="#image_path"){if($("#"+fileElementId).parents(".layer_1170").get(0))
parent=$(".upimg").eq(1).addClass('uping');else
parent=$("#"+fileElementId).parents(".upbox").addClass('uping');}else if(targetHdn=="#licence_image_path"){parent=$(".upimg").eq(2).addClass('uping');}else{parent=$("#"+fileElementId).parents(".upimg").addClass('uping');parent=$("#"+fileElementId).parents(".upimg2").addClass('uping');if(targetHdn=="#member_image_path")
parent=$("#teacher_face .img").addClass('uping');}
$.ajaxFileUpload({url:"home.php?m=Common&a=commonAjaxUploadImage&savePath="+savePath+"&imgSize="+imgSize+"&allowExts="+allowExts,secureuri:false,dataType:"json",fileElementId:fileElementId,success:function(data){if(data.msgCode=='000'){var imagePath=data.result;if(savePath=="teacherImgPath"){if(targetHdn=="#id_card_image_path"){upDone(0,imagePath);}else if(targetHdn=="#image_path"){upDone(1,imagePath);}else if(targetHdn=="#licence_image_path"){upDone(2,imagePath);}else if(targetHdn=="#banner_image_path"){imageUpDone('#upimg_banner',imagePath);}else if(targetHdn.indexOf("teacherWorks")>=0){imageUpDone(targetHdn.split(',')[1],imagePath);}else if(targetHdn=="#member_image_path"){imageUpDone('#teacher_face',imagePath);}}else if(savePath=="courseImgPath"){imageUpDone('.upfile_form',imagePath);}else{imageUpDone('.upimg',imagePath);}
if(targetHdn!=""){$(targetHdn).val(imagePath);}}else if(data.msgCode=="001"){parent.removeClass('uping');alert(data.result);}},error:function(){alert("error");}});}
function imageUpDone(e,imagePath){if(e=="#teacher_face")$(e+" .img").removeClass('uping');$(e+" .upbox").addClass("upover_box").removeClass('uping');$(e).find("p").hide();$(e).addClass("upover").removeClass('uping').find("img").attr('src',imagePath).ImgCenter();}
function sendSmsVerifyCode(type,e,noCountDown){var time=120;var self=$(".btn-blue",e)[0];var mobile=$.trim($("#mobile",e).val());var type=type||'register';var e=e||"body";if(!noCountDown){var defaultHtml=self.innerHTML;if(self.btn)return;self.btn=true;}
if(mobile==""){alert("请填写手机号！");self.btn=false;return false;}else if(!checkMobile(mobile)){alert("手机号格式不正确！");self.btn=false;return false;}
$.ajax({url:"/home.php?m=Member&a=sendSmsVerifyCode&mobile="+mobile+"&type="+type,type:"post",success:function(data,text){dataInJson=eval('('+data+')');if(dataInJson.errno=="000"){alert("发送成功，请注意查收！");setTiem();}else{alert(dataInJson.errmsg);}
self.btn=false;}});function setTiem(){if(!noCountDown){$(self).addClass('btn-gray');self.innerHTML=time+"后重发";self.timer=setInterval(function(){self.innerHTML=--time+"后重发";if(time==0){self.btn=false;$(self).removeClass('btn-gray').html(defaultHtml);clearInterval(self.timer);}},1000)}}}
function checkMobile(str){var re=/^[0-9]{11}$/
return re.test(str);}
function checkQq(str){var re=/^\d*$/
return re.test(str);}
function checkRegister(e){e=e||"body";if(!(e=='.win-forget-wrap'||e=='.b-forget-password-wrap')){var name=jQuery.trim(jQuery("#name",e).val());if(name==""){alert("请填写昵称！");return false;}}
var mobile=jQuery.trim(jQuery("#mobile",e).val());if(mobile==""){alert("请填写手机号！");return false;}else if(!checkMobile(mobile)){alert("手机号格式不正确！");return false;}
var verifyCode=jQuery.trim(jQuery("#verify_code",e).val());if(verifyCode==""){alert("请填写短信验证码！");return false;}
var password=jQuery.trim(jQuery("#password",e).val());if(password==""){alert("请填写登录密码！");return false;}else if(password.length<6){alert("密码至少为6位！");return false;}else{if(jQuery.trim(jQuery("#password_confirm",e).val())!=password){alert("两次输入的密码不一样！");return false;}}
return true;}
function checkLogin(e){e=e||"body";var mobile=jQuery.trim(jQuery("#mobile",e).val());if(mobile==""){alert("请填写手机号！");return false;}else if(!checkMobile(mobile)){alert("手机号格式不正确！");return false;}
var password=jQuery.trim(jQuery("#password",e).val());if(password==""){alert("请填写登录密码！");return false;}else if(password.length<6){alert("密码至少为6位！");return false;}
return true;}
function ajaxChangePassword(e){e=e||"body";if($("#check_code")[0]){if(/^\s*$/.test($("#check_code").val())){alert("请输入短信验证码");return false;}}
var new_password=$.trim($("#new_password",e).val());if(new_password==""){alert("请填写新密码！");return false;}else if(new_password.length<6){alert("新密码至少为6位！");return false;}
var new_password_confirm=$.trim($("#new_password_confirm",e).val());if(new_password_confirm==""){alert("请填写重复新密码！");return false;}else if(new_password_confirm.length<6){alert("重复新密码至少为6位！");return false;}else if(new_password_confirm!=new_password){alert("两次输入的新密码不一样！");return false;}
$.ajax({url:"/home.php?m=Member&a=changePassword",type:'post',data:{mobile:$.trim(jQuery("#mobile",e).val()),verify_code:$.trim(jQuery("#verify_code",e).val()),new_password:new_password,new_password_confirm:new_password_confirm},success:function(data,text){if(data.needLogin){showWin('.win-login-wrap');return;}else{if(data.isValidate){if(confirm('修改密码成功！')){window.location=location;}}else{alert(data.message);}}}});}
function checkJoinTravel(){var e=".travel-route-details-wrap .join-wrap";var name=$.trim($("#name",e).val());if(name==""){alert("请填写姓名！");return false;}
var mobile=$.trim($("#mobile",e).val());if(mobile==""){alert("请填写手机！");return false;}else if(!checkMobile(mobile)){alert("手机号格式不正确！");return false;}
var qq=$.trim($("#qq",e).val());if(qq==""){alert("请填写qq！");return false;}else if(!checkQq(qq)){alert("qq格式不正确！");return false;}
var date=$.trim($("#date",e).val());if(date==""){alert("请填写日期！");return false;}
return true;}
function showWin(e){if(document.documentElement.clientWidth<768){if(e==".win-login-wrap"){location.href="/home.php?m=Member&a=mlogin";return;}else if(e==".win-register-wrap"){location.href="/home.php?m=Member&a=mregister";return;}else if(e==".win-forget-wrap"){location.href="/home.php?m=Member&a=mforget";return;}}
$(".win-wrap").hide();$(e).fadeIn();$(e).css("left",($(window).width()-$(e).width())/2);if(e==".lottery-sub-course-wrap"||e==".lottery-course-wrap"||e==".lottery-package-wrap"||e==".lottery-rule-wrap"){if(e==".lottery-course-wrap"){$(e).css("top",($(window).height()-$(e).height()-184)/2+184);}else if(e==".lottery-sub-course-wrap"){$(e).css("top",($(window).height()-$(e).height()-48)/2+48);}else if(e==".lottery-package-wrap"){$(e).css("top",($(window).height()-$(e).height()-195)/2+195);}else{$(e).css("top",($(window).height()-$(e).height())/2);}}else{$(e).css("top",($(window).height()-$(e).height()-110)/2);}
$('.black-back').fadeIn();}
function hideWin(){$(".win-wrap").fadeOut();$('.black-back').fadeOut();}
function ajaxCheckLogin(e){jQuery.ajax({url:'/home.php?m=Member&a=ajaxCheckLogin',type:'post',dataType:"json",success:function(data,text){var returnUrl=jQuery(e).attr("href");if(!data){showWin('.win-login-wrap');jQuery("input[name=returnUrl]").val(returnUrl);return;}else{window.location=returnUrl;}}});}
function ajaxCheckLoginPure(e){var result=false;jQuery.ajax({async:false,url:'/home.php?m=Member&a=ajaxCheckLogin',type:'post',dataType:"json",success:function(data,text){result=data;}});return result;}
function ajaxLogin(){if(checkLogin('.win-login-wrap')){jQuery.ajax({url:'/home.php?m=Member&a=ajaxLogin',type:"post",data:{mobile:jQuery.trim(jQuery("#mobile",".win-login-wrap").val()),password:jQuery.trim(jQuery("#password",".win-login-wrap").val())},dataType:"json",success:function(data,text){if(data.isValidate){var returnUrl=jQuery.trim(jQuery("#returnUrl").val());if(returnUrl!=""){window.location=jQuery("#returnUrl").val();}else{window.location=location;}}else{alert(data.message);}}});}}
function ajaxRegister(){if(checkRegister('.win-register-wrap')){jQuery.ajax({url:"/home.php?m=Member&a=ajaxRegister",type:"post",data:{name:jQuery.trim(jQuery("#name",".win-register-wrap").val()),mobile:jQuery.trim(jQuery("#mobile",".win-register-wrap").val()),verify_code:jQuery.trim(jQuery("#verify_code",".win-register-wrap").val()),password:jQuery.trim(jQuery("#password",".win-register-wrap").val()),password_confirm:jQuery.trim(jQuery("#password_confirm",".win-register-wrap").val())},dataType:"json",success:function(data,text){if(data.isValidate){var returnUrl=jQuery.trim(jQuery("#returnUrl").val());if(returnUrl!=""){}
showWin('.win-register-success-wrap');}else{alert(data.message);}}});}}
function ajaxForget(){if(checkRegister('.win-forget-wrap')){jQuery.v_path=jQuery.ajax({url:"/home.php?m=Member&a=ajaxForget",type:"post",data:{mobile:jQuery.trim(jQuery("#mobile",".win-forget-wrap").val()),verify_code:jQuery.trim(jQuery("#verify_code",".win-forget-wrap").val()),password:jQuery.trim(jQuery("#password",".win-forget-wrap").val()),password_confirm:jQuery.trim(jQuery("#password_confirm",".win-forget-wrap").val())},dataType:"json",success:function(data,text){if(data.isValidate){if(confirm('重置密码成功，马上登录？')){showWin('.win-login-wrap');}}else{alert(data.message);}}});}}
function checkConfirm(){var e=".common-user-center-wrap";var name=$.trim($("#name",e).val());if(name==""){alert("请填写姓名！");return false;}
var qq=jQuery.trim(jQuery("#qq",e).val());if(qq==""){alert("请填写qq！");return false;}
return true;}
function showBlackBg(){$(".black-bg").show();}
function hideBlackBg(){$(".black-bg").hide();}
function toggleBlackBg(){$(".black-bg").toggle();}
function getPolyvCode(dataCode){var code=dataCode||$("#polyv_code").val();code=code.replace(/\+/,".");code=code.replace(/\//,"_");code=code.replace(/=/,"*");return code;}
function stopAndShowInfo(){jQuery(".player-wrap").addClass("notshow");jQuery(".live-course-hearder-wrap").removeClass("notshow");$(".course-black-header-bg").css("height","415px");var e=document.getElementById('course-desc');changeMyTab(e);}
function hideVedio(isConfirm){var ship_num=$("#ship_num").val();if(ship_num){if(isConfirm){actionFn();}else{var course_id=$("#course_id").val();var sub_course_id=$("#sub_course_id").val();var real_watch_time=polyvPlayer.j2s_stayInVideoTime();var course_type=$("#course_type").val();$.ajax({url:"/home.php?m=Course&a=courseDetail",type:"post",data:{course_id:course_id,sub_course_id:sub_course_id,course_type:course_type},dataType:"json",success:function(data,text){if(data.is_show){if((data.time-real_watch_time)>0){var percent=(data.time-real_watch_time)/data.all_time;var percent=parseInt(percent*100);if(parseInt(percent)<=10){showPointIng(percent);}else{actionFn();}}else{actionFn();}}else{actionFn();}},error:function(XMLHttpRequest,textStatus,errorThrown){console.log(XMLHttpRequest);console.log(textStatus);console.log(errorThrown);}});}}else{actionFn();}
function actionFn(){addPlayLog();toggleBlackBg();$(".playing-wrap").hide();hidePoints();if($(".win-buy-course-wrap").length>0){$(".win-buy-course-wrap").hide();}
if($(".share-wrap").length>0){$(".share-wrap").hide();}}}
function showVedio(vid,name){if(vid){showBlackBg();$(".playing-wrap").show();polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':vid,'flashvars':{"code":getPolyvCode(),"autoplay":"true","setScreen":"16_9"}});$.ajax({url:"/home.php?m=Course&a=getCoursePlaying",type:"post",data:{id:$("#id").val(),code:$("#polyv_code").val()},dataType:"json",success:function(data,text){}});}else{if($(".chapter-sub-course-list").length>0){if($(".chapter-sub-course-list li").length<=0){alert("暂时没有视频！");return false;}
$(".chapter-sub-course-list li").eq(0).click();}
else{if($(".video_catalog_tab .show_bar").length<=0){alert("暂时没有视频！");return false;}
$(".video_catalog_tab .show_bar").eq(0).click();}}
var e=document.getElementById("course-catelog");changeMyTab(e);}
function showVedioNew(){if($(".repeat_play_tab dd a").length<=0){alert("暂无回放，谢谢！");return false;}
$(".tab_nav a").eq(1).click();$(".repeat_play_tab dd a").eq(0).click();}
function courseShare(){polyvPlayer.j2s_pauseVideo()
$('.share-wrap').show();}
function courseGoToComment(){hideVedio();if($(".tab_nav a").length>0){$(".tab_nav a").eq(2).click();}
else{$('html, body').animate({scrollTop:$('.course-comment-list-wrap').position().top},'slow');}}
function checkBulkPay(){if(jQuery(".chk:checked").length<=0){alert("请至少选择一个订单!");return false;}
var ids="(";jQuery(".chk:checked").each(function(e){ids+=ids=="("?jQuery(this).val():","+jQuery(this).val();});ids+=")";window.location='home.php?m=Order&a=pay&id='+ids;}
function togglePayType(e,type){$(".pay-type").attr('src',"./images/alipay_selected.png");$("#pay_type").val(type);$(".bank-wrap img.selected").each(function(e){$(this).attr("src","./images/bank/"+$(this).attr("data-type")+".png");$(this).removeClass("selected");});}
function selectBank(e){var last=$(".bank-wrap img.selected");var lastType=last.attr("data-type");last.attr("src","./images/bank/"+lastType+".png").removeClass('selected');$(e).parent().find("img.selected").attr("src","./images/bank/"+$(e).parent().find("img.selected").attr("data-type")+".png").removeClass('selected');var currentType=$(e).attr("data-type");$(e).attr("src","./images/bank/"+currentType+"_1.png");$(e).addClass("selected");$("#bank").val(currentType);$("#pay_type").val("union");$(".pay-type").attr('src',"./images/alipay.png");}
function checkWithdrawVerify(){if(jQuery.trim(jQuery("#withdraw_type",e).val())==""){alert("请填写提现账号类型！");return false;}
if(jQuery.trim(jQuery("#withdraw_account",e).val())==""){alert("请填写提现账号！");return false;}
if(jQuery.trim(jQuery("#withdraw_name",e).val())==""){alert("请填写提现账号姓名！");return false;}
return true;}
function checkSetWithdrawVerify(){var money=jQuery.trim(jQuery("#money").val());if(money==""){alert("请填写提现账号收到的随机金额！");return false;}else{var reg=/^([0-9]*[1-9][0-9]*(\.[0-9]{1,2})?|0\.[1-9][0-9]?|0\.0[1-9])$/;if(!reg.test(money)){alert('金额应为正数，且最多保留两位小数');return false;}}
return true;}
var polyvPlayer;function tryPlay(id,e){$(".playing-wrap .buy-sub-btn").attr("href","home.php?m=Order&a=subCourseConfirm&id="+id);$(".win-buy-course-wrap .buy-sub-course-btn").attr("href","home.php?m=Order&a=subCourseConfirm&id="+id);$(".win-buy-course-wrap .buy-course-btn").attr("href","home.php?m=Order&a=courseConfirm&id="+$("#id").val());$(".over_show").hide();var dataCode=$(e).attr("data-code");var ship_num=$("#ship_num").val();$("#sub_course_id").val(id);$.ajax({url:"/home.php?m=Course&a=getCoursePlaying",type:"post",data:{id:id,code:dataCode||$("#polyv_code").val()},dataType:"json",success:function(data,text){if($("#course_id")[0]){$("#course_id").val(data.course_id);}
if($("#sub_course_id")[0]){$("#sub_course_id").val(data.sub_course_id);}
if($("#course_type")[0]){$("#course_type").val(data.course_type);}
if(data.need_login){showWin('.win-login-wrap');return false;}
$(".course_original").show();$(".video_original").hide();if(data.isValidate){if($("#is_index")[0]){$("#is_index").val("1");window._bd_share_config.share.bdText=data.name;window._bd_share_config.share.bdUrl=window.__ROOT__+data.url+"&sub_course_id="+data.sub_course_id+"&p=1";window._bd_share_config.share.bdPic=data.course_image_path;}
if($("#pager")[0]&&$("#pager").val()=="category-video"){window._bd_share_config.share.bdText=data.course_name+"-小节："+data.name;window._bd_share_config.share.bdUrl=window.__ROOT__+data.url;window._bd_share_config.share.bdPic=data.course_image_path;}
$(".current-sub-course-name").html(data.name);$(".current-sub-course-time").html(data.time);$(".course_original .current-course-name").html(data.course_name).attr('href',data.url);$(".close_name").html(data.course_name);$(".close_name").attr('href',data.url);$(".win-buy-course-wrap .current-sub-course-price").html(data.price);$(".current-course-price").html($("#price").val());$("#is_pre_play").val(0);if(data.is_free==1){polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(dataCode),"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time,"ban_history_time":"on"}});showBlackBg();$(".playing-wrap").fadeIn();if(parseInt(data.ship_money)>0&&data.ship_money!='undefined'){showPoint(data.ship_money);}
setInterval(function(){checkShip();},30000);$(".playing-wrap .buy-btn").hide();}
else if(data.is_free==2){if(data.is_year_bought||data.is_course_bought||data.is_sub_course_bought){polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(dataCode),"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time,"ban_history_time":"on"}});showBlackBg();$(".playing-wrap").show();if(data.is_year_bought||data.is_course_bought){$(".playing-wrap .buy-btn").hide();}else{$(".playing-wrap .buy-btn").hide();$(".playing-wrap .buy-course-btn").show();}
if(parseInt(data.ship_money)>0&&data.ship_money!='undefined'){showPoint(data.ship_money);}
setInterval(function(){checkShip();},30000);}
else{polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(dataCode),"watchEndTime":data.free_play_time,"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time,"ban_history_time":"on"}});showBlackBg();$(".playing-wrap").show();$(".playing-wrap .buy-btn").show();$("#is_pre_play").val(1);if(parseInt(data.ship_money)>0&&data.ship_money!='undefined'){showPoint(data.ship_money);}
setInterval(function(){checkShip();},30000);}}
else{if(data.is_year_bought||data.is_course_bought||data.is_sub_course_bought){polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(dataCode),"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time,"ban_history_time":"on"}});showBlackBg();$(".playing-wrap").show();if(data.is_year_bought||data.is_course_bought){$(".playing-wrap .buy-btn").hide();}else{$(".playing-wrap .buy-btn").hide();$(".playing-wrap .buy-course-btn").show();}
if(parseInt(data.ship_money)>0&&data.ship_money!='undefined'){showPoint(data.ship_money);}
setInterval(function(){checkShip();},30000);}
else{if($("#action")=="telecoursedetails"){$(".state_box").removeClass("notshow");}
else{alert("抱歉，该视频需要购买才能播放！");}}}}
else{alert("抱歉，获取播放参数失败！");}},error:function(XMLHttpRequest,textStatus,errorThrown){console.log(XMLHttpRequest);console.log(textStatus);console.log(errorThrown);}});}
function tryPlay1(id,e,channel_key){$(".playing-wrap .buy-sub-btn").attr("href","home.php?m=Order&a=subCourseConfirm&id="+id+"&channel_key="+channel_key);$(".win-buy-course-wrap .buy-sub-course-btn").attr("href","home.php?m=Order&a=subCourseConfirm&id="+id+"&channel_key="+channel_key);$(".win-buy-course-wrap .buy-course-btn").attr("href","home.php?m=Order&a=courseConfirm&id="+$("#id").val()+"&channel_key="+channel_key);$(".over_show").hide();var dataCode=$(e).attr("data-code");var ship_num=$("#ship_num").val();$("#sub_course_id").val(id);$.ajax({url:"/home.php?m=Course&a=getCoursePlaying",type:"post",data:{id:id,code:dataCode||$("#polyv_code").val()},dataType:"json",success:function(data,text){if($("#course_id")[0]){$("#course_id").val(data.course_id);}
if($("#sub_course_id")[0]){$("#sub_course_id").val(data.sub_course_id);}
if($("#course_type")[0]){$("#course_type").val(data.course_type);}
if(data.need_login){showWin('.win-login-wrap');return false;}
$(".course_original").show();$(".video_original").hide();if(data.isValidate){if($("#is_index")[0]){$("#is_index").val("1");window._bd_share_config.share.bdText=data.name;window._bd_share_config.share.bdUrl=window.__ROOT__+data.url+"&sub_course_id="+data.sub_course_id+"&p=1";window._bd_share_config.share.bdPic=data.course_image_path;}
if($("#pager")[0]&&$("#pager").val()=="category-video"){window._bd_share_config.share.bdText=data.course_name+"-小节："+data.name;window._bd_share_config.share.bdUrl=window.__ROOT__+data.url;window._bd_share_config.share.bdPic=data.course_image_path;}
$(".current-sub-course-name").html(data.name);$(".current-sub-course-time").html(data.time);$(".course_original .current-course-name").html(data.course_name).attr('href',data.url);$(".close_name").html(data.course_name);$(".close_name").attr('href',data.url);$(".win-buy-course-wrap .current-sub-course-price").html(data.price);$(".current-course-price").html($("#price").val());$("#is_pre_play").val(0);if(data.is_free==1){polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(dataCode),"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time,"ban_history_time":"on"}});showBlackBg();$(".playing-wrap").fadeIn();if(parseInt(data.ship_money)>0&&data.ship_money!='undefined'){showPoint(data.ship_money);}
setInterval(function(){checkShip();},30000);$(".playing-wrap .buy-btn").hide();}
else if(data.is_free==2){if(data.is_year_bought||data.is_course_bought||data.is_sub_course_bought){polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(dataCode),"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time,"ban_history_time":"on"}});showBlackBg();$(".playing-wrap").show();if(data.is_year_bought||data.is_course_bought){$(".playing-wrap .buy-btn").hide();}else{$(".playing-wrap .buy-btn").hide();$(".playing-wrap .buy-course-btn").show();}
if(parseInt(data.ship_money)>0&&data.ship_money!='undefined'){showPoint(data.ship_money);}
setInterval(function(){checkShip();},30000);}
else{polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(dataCode),"watchEndTime":data.free_play_time,"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time,"ban_history_time":"on"}});showBlackBg();$(".playing-wrap").show();$(".playing-wrap .buy-btn").show();$("#is_pre_play").val(1);if(parseInt(data.ship_money)>0&&data.ship_money!='undefined'){showPoint(data.ship_money);}
setInterval(function(){checkShip();},30000);}}
else{if(data.is_year_bought||data.is_course_bought||data.is_sub_course_bought){polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(dataCode),"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time,"ban_history_time":"on"}});showBlackBg();$(".playing-wrap").show();if(data.is_year_bought||data.is_course_bought){$(".playing-wrap .buy-btn").hide();}else{$(".playing-wrap .buy-btn").hide();$(".playing-wrap .buy-course-btn").show();}
if(parseInt(data.ship_money)>0&&data.ship_money!='undefined'){showPoint(data.ship_money);}
setInterval(function(){checkShip();},30000);}
else{if($("#action")=="telecoursedetails"){$(".state_box").removeClass("notshow");}
else{alert("抱歉，该视频需要购买才能播放！");}}}}
else{alert("抱歉，获取播放参数失败！");}},error:function(XMLHttpRequest,textStatus,errorThrown){console.log(XMLHttpRequest);console.log(textStatus);console.log(errorThrown);}});}
function tryPlay2(id,e,channel_key){$(".playing-wrap .buy-sub-btn").attr("href","/home.php?m=Order&a=subConfirm&id="+id+"&channel_key="+channel_key);$(".win-buy-course-wrap .buy-sub-course-btn").attr("href","/home.php?m=Order&a=subConfirm&id="+id+"&channel_key="+channel_key);$(".win-buy-course-wrap .buy-course-btn").attr("href","/home.php?m=Order&a=Confirm&id="+$("#id").val()+"&channel_key="+channel_key);$(".over_show").hide();var dataCode=$(e).attr("data-code");var ship_num=$("#ship_num").val();$("#sub_course_id").val(id);$.ajax({url:"/home.php?m=Course&a=getCoursePlaying",type:"post",data:{id:id,code:dataCode||$("#polyv_code").val()},dataType:"json",success:function(data,text){if($("#course_id")[0]){$("#course_id").val(data.course_id);}
if($("#sub_course_id")[0]){$("#sub_course_id").val(data.sub_course_id);}
if($("#course_type")[0]){$("#course_type").val(data.course_type);}
if(data.need_login){showWin('.win-login-wrap');return false;}
$(".course_original").show();$(".video_original").hide();if(data.isValidate){if($("#is_index")[0]){$("#is_index").val("1");window._bd_share_config.share.bdText=data.name;window._bd_share_config.share.bdUrl=window.__ROOT__+data.url+"&sub_course_id="+data.sub_course_id+"&p=1";window._bd_share_config.share.bdPic=data.course_image_path;}
if($("#pager")[0]&&$("#pager").val()=="category-video"){window._bd_share_config.share.bdText=data.course_name+"-小节："+data.name;window._bd_share_config.share.bdUrl=window.__ROOT__+data.url;window._bd_share_config.share.bdPic=data.course_image_path;}
$(".current-sub-course-name").html(data.name);$(".current-sub-course-time").html(data.time);$(".course_original .current-course-name").html(data.course_name).attr('href',data.url);$(".close_name").html(data.course_name);$(".close_name").attr('href',data.url);$(".win-buy-course-wrap .current-sub-course-price").html(data.price);$(".current-course-price").html($("#price").val());$("#is_pre_play").val(0);if(data.is_free==1){polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(dataCode),"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time,"ban_history_time":"on"}});showBlackBg();$(".playing-wrap").fadeIn();if(parseInt(data.ship_money)>0&&data.ship_money!='undefined'){showPoint(data.ship_money);}
setInterval(function(){checkShip();},30000);$(".playing-wrap .buy-btn").hide();}
else if(data.is_free==2){if(data.is_year_bought||data.is_course_bought||data.is_sub_course_bought){polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(dataCode),"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time,"ban_history_time":"on"}});showBlackBg();$(".playing-wrap").show();if(data.is_year_bought||data.is_course_bought){$(".playing-wrap .buy-btn").hide();}else{$(".playing-wrap .buy-btn").hide();$(".playing-wrap .buy-course-btn").show();}
if(parseInt(data.ship_money)>0&&data.ship_money!='undefined'){showPoint(data.ship_money);}
setInterval(function(){checkShip();},30000);}
else{polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(dataCode),"watchEndTime":data.free_play_time,"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time,"ban_history_time":"on"}});showBlackBg();$(".playing-wrap").show();$(".playing-wrap .buy-btn").show();$("#is_pre_play").val(1);if(parseInt(data.ship_money)>0&&data.ship_money!='undefined'){showPoint(data.ship_money);}
setInterval(function(){checkShip();},30000);}}
else{if(data.is_year_bought||data.is_course_bought||data.is_sub_course_bought){polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(dataCode),"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time,"ban_history_time":"on"}});showBlackBg();$(".playing-wrap").show();if(data.is_year_bought||data.is_course_bought){$(".playing-wrap .buy-btn").hide();}else{$(".playing-wrap .buy-btn").hide();$(".playing-wrap .buy-course-btn").show();}
if(parseInt(data.ship_money)>0&&data.ship_money!='undefined'){showPoint(data.ship_money);}
setInterval(function(){checkShip();},30000);}
else{if($("#action")=="telecoursedetails"){$(".state_box").removeClass("notshow");}
else{alert("抱歉，该视频需要购买才能播放！");}}}}
else{alert("抱歉，获取播放参数失败！");}},error:function(XMLHttpRequest,textStatus,errorThrown){console.log(XMLHttpRequest);console.log(textStatus);console.log(errorThrown);}});}
function tryPlayInPostsVideo(id,e,href){$("#is_index").val("0");$(".over_show").hide();$(".course_original").hide();$(".video_original").show().find(".current-course-name").html("视频图文>>").attr("href",href);$.ajax({url:"/home.php?m=Video&a=getVideoPlaying",type:"post",data:{id:id,},dataType:"json",success:function(data){if(data.isValidate){$("#is_pre_play").val(0);$(".current-sub-course-name").html(data.name);$(".current-sub-course-time").html(data.time);if(data.is_free==1){polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":data.code,"autoplay":"true","setScreen":"16_9",}});showBlackBg();$(".playing-wrap").show();$(".playing-wrap .buy-btn").hide();}}else{alert("抱歉，获取播放参数失败！");}},error:function(data){alert("播放失败，请稍后再试！");}});}
function playback(id){$.ajax({url:"/home.php?m=Course&a=getCoursePlaying",type:"post",data:{id:id,code:$("#polyv_code").val()},dataType:"json",success:function(data,text){if(data.need_login){showWin('.win-login-wrap');return false;}
if(data.isValidate){$("#is_pre_play").val(0);if(data.is_free==1){polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(),"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time}});showBlackBg();$(".playing-wrap").show();$(".playing-wrap .buy-btn").hide();}else if(data.is_free==2){if(data.is_year_bought||data.is_course_bought||data.is_sub_course_bought){polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(),"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time}});showBlackBg();$(".playing-wrap").show();if(data.is_year_bought||data.is_course_bought){$(".playing-wrap .buy-btn").hide();}else{$(".playing-wrap .buy-btn").hide();$(".playing-wrap .buy-course-btn").show();}}else{polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(),"watchEndTime":data.free_play_time,"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time}});showBlackBg();$(".playing-wrap").show();$(".playing-wrap .buy-btn").show();$("#is_pre_play").val(1);}}else{if(data.is_year_bought||data.is_course_bought||data.is_sub_course_bought){polyvPlayer=polyvObject("#polyv-player").videoPlayer({'width':'875','height':'434','vid':data.polyv_vid,'flashvars':{"code":getPolyvCode(),"autoplay":"true","setScreen":"16_9","watchStartTime":data.watch_start_time}});showBlackBg();$(".playing-wrap").show();if(data.is_year_bought||data.is_course_bought){$(".playing-wrap .buy-btn").hide();}else{$(".playing-wrap .buy-btn").hide();$(".playing-wrap .buy-course-btn").show();}}else{alert("请先购买该课程！");self.opener=null;self.close();}}}else{alert("抱歉，获取播放参数失败！");}}});}
function s2j_onPlayOver(){addPlayLog();if($("#is_index").val()=="1"){$('.over_show').show();}if($("#is_pre_play").val()=="1"){$('.win-buy-course-wrap').show();}}
function getPlayer(movieName){if(movieName==undifined){}
if(navigator.appName.indexOf("Microsoft")!=-1){var reObj=window[movieName];try{if(reObj.length>0){return reObj[0];}else{return reObj;}}catch(e){}
return;}else{return document[movieName];}}
function checkCourse(){if(jQuery.trim(jQuery("#course_name").val())==""){alert(jQuery("#course_name").prev("label").text().replace(" *","")+"不允许为空！");return false;}
var time=jQuery.trim(jQuery("#course_time").val());if(time==""){alert(jQuery("#course_time").prev("label").text().replace(" *","")+"不允许为空！");return false;}else{if(!/^[1-9]\d*$/.test(time)){alert(jQuery("#course_time").prev("label").text().replace(" *","")+"应为正整数！");return false;}}
var price=jQuery.trim(jQuery("#course_price").val());if(price==""){alert(jQuery("#course_price").prev("label").text().replace(" *","")+"不允许为空！");return false;}else{if(!/^([0-9]*[1-9][0-9]*(\.[0-9]{1,2})?|0\.[1-9][0-9]?|0\.0[1-9])$/.test(price)){alert(jQuery("#course_price").prev("label").text().replace(" *","")+"应为正数，且最多保留两位小数！");return false;}}
var commission=jQuery.trim(jQuery("#course_commission").val());if(commission==""){alert(jQuery("#course_commission").prev("label").text().replace(" *","")+"不允许为空！");return false;}else{if(!/^([0-9]*[1-9][0-9]*(\.[0-9]{1,2})?|0\.[1-9][0-9]?|0\.0[1-9])$/.test(commission)){alert(jQuery("#course_commission").prev("label").text().replace(" *","")+"应为正数，且最多保留两位小数！");return false;}}
if(jQuery.trim(jQuery("#image_path").val())==""){alert(jQuery("#image_path").prev("label").text().replace(" *","")+"不允许为空！");return false;}
if(jQuery.trim(jQuery("#short_desc").val())==""){alert(jQuery("#short_desc").prev("label").text().replace(" *","")+"不允许为空！");return false;}
if(jQuery.trim(ue[0].getContent())==""){alert(jQuery("#description").prev("label").text().replace(" *","")+"不允许为空！");return false;}
return true;}
function checkSubCourse(){if(jQuery.trim(jQuery("#polyv_vid").val())==""){alert(jQuery("#polyv_vid").prev("label").text().replace(" *","")+"不允许为空！");return false;}
if(jQuery.trim(jQuery("#course_name").val())==""){alert(jQuery("#course_name").prev("label").text().replace(" *","")+"不允许为空！");return false;}
var time=jQuery.trim(jQuery("#course_time").val());if(time==""){alert(jQuery("#course_time").prev("label").text().replace(" *","")+"不允许为空！");return false;}
if($(".is-free:checked").val()=="2"){if($.trim($("#free_play_time").val())==""){alert($("#free_play_time").prev("label").text()+"不允许为空！");return false;}else{var reg=new Regex("/^[1-9]\d*$/");if(reg.test($.trim($("#free_play_time").val()))){alert($("#free_play_time").prev("label").text()+"应为正整数！");return false;}}}
var price=jQuery.trim(jQuery("#course_price").val());if(price==""){alert(jQuery("#course_price").prev("label").text().replace(" *","")+"不允许为空！");return false;}else{if(!/^([0-9]*[1-9][0-9]*(\.[0-9]{1,2})?|0\.[1-9][0-9]?|0\.0[1-9])$/.test(price)){alert(jQuery("#course_price").prev("label").text().replace(" *","")+"应为正数，且最多保留两位小数！");return false;}}
var commission=jQuery.trim(jQuery("#course_commission").val());if(commission==""){alert(jQuery("#course_commission").prev("label").text().replace(" *","")+"不允许为空！");return false;}else{if(!/^([0-9]*[1-9][0-9]*(\.[0-9]{1,2})?|0\.[1-9][0-9]?|0\.0[1-9])$/.test(commission)){alert(jQuery("#course_commission").prev("label").text().replace(" *","")+"应为正数，且最多保留两位小数！");return false;}}
return true;}
function checkWorks(){if($.trim($("#works_title").val())==""){alert("请填写标题！");return false;}
if($.trim($("#works_image_path").val())==""){alert("请至少选择一张图片！");return false;}
if(ue[0].getContent()==""){alert("请填写投稿内容！");return false;}
if($("#works_type").val()==""){alert("请填写分类！");return false;}
var tags=$.trim($("#works_tags").val());if(tags!=""){var tagSplit=tags.split(' ');if(tagSplit.length>5){alert("标签个数最多不超过5个！");return false;}else{for(var i=0;i<tagSplit.length;i++){if(tagSplit[i].length>10){alert("每个标签字数最多不超过10！");return false;}}}}
return true;}
function checkResume(e){e=e||"body";var name=jQuery.trim(jQuery("#resume_name",e).val());if(name==""){alert("请填写真实姓名！");return false;}
var email=jQuery.trim(jQuery("#resume_email",e).val());if(email==""){alert("请填写邮箱！");return false;}else{var filter=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!filter.test(email)){alert("邮箱格式不正确！");return false;}}
var mobile=jQuery.trim(jQuery("#resume_mobile",e).val());if(mobile==""){alert("请填写手机！");return false;}else{var filter=/^[1][3578][0-9]{9}$/;if(!filter.test(mobile)){alert("手机格式不正确！");return false;}}
var resume_url=jQuery.trim(jQuery("#resume_url",e).val());if(resume_url==""){alert("请上传简历！");return false;}
var works_url=jQuery.trim(jQuery("#works_url",e).val());if(works_url==""){alert("请上传作品集！");return false;}
return true;}
function getCourseCataId(){var cid=$.trim($("#polyv_cid").val());if(cid!=""){return cid;}
return "1443061440576";}
function getWriteToken(){var result="";jQuery.ajax({url:"home.php?m=Common&a=getPolyvWriteToken",type:"post",async:false,data:{},success:function(data,text){result=data;}});return result;}
function getSubCoutseJSONRPC(){return{title:jQuery.trim(jQuery("#course_name").val()),tag:"视频子课程",desc:jQuery.trim(jQuery("#course_name").val())};}
function getPolyvSign(){var sign="";var datas=getSubCoutseJSONRPC();datas.cataid=getCourseCataId();jQuery.ajax({url:"home.php?m=Common&a=getPolyvSign",type:"post",async:false,data:datas,success:function(data,text){sign=data;}});return sign;}
function changePolyvVid(dataInJson){dataInJson=dataInJson||{};var vidId=dataInJson.vidId||"#polyv_vid";var vid=jQuery.trim(jQuery(vidId).val());if(vid==""){alert("当前无可播放视频");return false;}
polyvPlayer.changeVid(vid);}
function initPolyvPlayer(dataInJson){dataInJson=dataInJson||{};var playerId=dataInJson.playerId||'#polyv_player';var vidId=dataInJson.vidId||"#polyv_vid";var vid=$.trim($(vidId).val());if(vid==""){return false;}
var free_play_time=parseInt($("#free_play_time").val());if(free_play_time>0){polyvPlayer=polyvObject(playerId).videoPlayer({'width':'600','height':'337','vid':vid,'flashvars':{"code":getPolyvCode(),"watchEndTime":free_play_time,"setScreen":"16_9"}});}else{polyvPlayer=polyvObject(playerId).videoPlayer({'width':'600','height':'337','vid':vid,'flashvars':{'code':getPolyvCode(),"setScreen":"16_9"}});}}
function showMoreTeacher(e){$(e).remove();$(".teacher-list-wrap .teacher-wrap").removeClass("notshow");}
function toggleCourseType(e){if($(".second-category-menu-wrap").hasClass("notshow")){$(".second-category-menu-wrap").removeClass("notshow");$(e).parent().addClass("unfold");}else{$(".second-category-menu-wrap").addClass("notshow");$(e).parent().removeClass("unfold");}}
function calcTime(){var left=parseInt($("#time_left").val());if(left<=0){window.location=location;}
var implement=100;var day=parseInt(left/(24*60*60*1000));var hour=parseInt((left%(24*60*60*1000))/(60*60*1000));var min=parseInt((left%(60*60*1000))/(60*1000));var sec=parseInt((left%(60*1000))/(1000));var mSec=parseInt((left%1000)/100);if(day>0){$(".time-banner .day").html(day);}else{$(".time-banner .day-wrap").hide();}
$(".time-banner .hour").html(hour);$(".time-banner .min").html(min);$(".time-banner .sec").html(sec+"."+mSec);left-=implement;$("#time_left").val(left);}
function imageChanged(){$.ajaxFileUpload({url:'/home.php?m=Common&a=ajaxUploadImage',secureuri:false,fileElementId:'imgUp',dataType:'json',success:function(data,status){if(data.msgCode!='000'){alert(data.result);}
var imagePath=data.result;$("#portraitToBeChange").attr("src",imagePath);$("#portraitToBeChange").cropper('replace',imagePath);setTimeout(function(){var canvasData=$("#portraitToBeChange").cropper('getCropBoxData');$(".win-change-portrait-wrap #x").val(canvasData.left);$(".win-change-portrait-wrap #y").val(canvasData.top);$(".win-change-portrait-wrap #w").val(390);$(".win-change-portrait-wrap #h").val(390);},1000);},error:function(){alert("对不起，上传出错了！");}});}
function savePortrait(){$.ajax({url:"home.php?m=Member&a=savePortrait",type:"post",async:false,data:{image_path:$("#portraitToBeChange").attr("src"),x:$(".win-change-portrait-wrap #x").val(),y:$(".win-change-portrait-wrap #y").val(),w:$(".win-change-portrait-wrap #w").val(),h:$(".win-change-portrait-wrap #h").val()},success:function(data,text){if(data.isValidate){window.location=location;}else{alert(data.message);}}});}
function showImageList(index){$(".full-black-bg").show();$(".touch-slide-wrap").hide();$("#slide"+index).show();}
function checkLottery(id){$.ajax({url:"/home.php?m=Lottery&a=check&id="+id,type:"post",success:function(data,text){if(data.isValidate){showWin('.lottery-rule-wrap');}else{if(data.message=="请先登录！"){showWin('.win-login-wrap');}else if(data.message=="今天抽奖次数已用完！明天再来吧！"){showWin('.lottery-over-wrap');}else{alert(data.message);}}}});}
function getPrize(id){$.ajax({url:"/home.php?m=Lottery&a=getPrize&id="+id,type:"post",success:function(data,text){if(data.isValidate){if(data.type=="sub_course"){$(".lottery-sub-course-wrap .border_btn").eq(0).attr("href","/home.php?m=Course&a=details&id="+data.course_id+"&sub_course_id="+data.id);$(".lottery-sub-course-wrap .course-name").eq(0).html(data.course_name+" "+data.name.split(' ')[0]);$(".lottery-sub-course-wrap .course-name").eq(1).html("子课程一节");$(".lottery-sub-course-wrap li img").attr('src',data.image_path);showWin('.lottery-sub-course-wrap');}else if(data.type=="course"){$(".lottery-course-wrap .border_btn").eq(0).attr("href","/home.php?m=Course&a=details&id="+data.course_id+"&sub_course_id="+data.id);$(".lottery-course-wrap .course-name").eq(0).html(data.course_name);$(".lottery-course-wrap .course-name").eq(1).html("课程一套");$(".lottery-course-wrap li img").attr('src',data.image_path);showWin('.lottery-course-wrap');}else if(data.type=="package"){$(".lottery-package-wrap .border_btn").eq(0).attr("href","/home.php?m=Course&a=details&id="+data.course_id+"&sub_course_id="+data.id);$(".lottery-package-wrap .course-name").eq(0).html(data.course_name);$(".lottery-package-wrap .course-name").eq(1).html("课程合辑一套");$(".lottery-package-wrap li img").attr('src',data.image_path);showWin('.lottery-package-wrap');}}else{if(data.message=="请先登录！"){showWin('.win-login-wrap');}else if(data.message=="今天抽奖次数已用完！明天再来吧！"){showWin('.lottery-over-wrap');}else{alert(data.message);}}}});}
function vote(type,value){$.ajax({url:"/home.php?m=Hot&a=vote",type:"post",data:{type:type,value:value},success:function(data,text){if(!data.isLogin){showWin('.win-login-wrap');}else{if(data.isValidate){$(".vote-1").html(data.percent1);$(".vote-2").html(data.percent2);$(".bar-left").css("width",data.percent1+"%");}else{alert(data.message);}}}});}
function hotCommentNow(type){var content=$.trim($("#content").val());if(content==""){alert("请填写缅怀内容！");return false;}
if(ajaxCheckLoginPure()){$.ajax({async:false,url:"/home.php?m=Hot&a=commentNow",type:'post',data:{type:type,content:content},dataType:"json",success:function(data,text){if(data.isValidate){var html='<li><img class="image-path" src="'+data.image_path+'" /><div><h4>'+data.name+'</h4><p>'+content+'</p></div></li>';$(html).prependTo(".comment-list");$("#content").val("");}else{alert(data.message);}}});}else{showWin('.win-login-wrap');return;}}
function allHotComment(type,e){$.ajax({async:false,url:"/home.php?m=Hot&a=allComment",type:'post',data:{type:type},dataType:"json",success:function(data,text){$(".comment-list").html(data.html);$(e).remove();}});}
function beforeCourseReplyNew(id,name){$("#content").val("");$("#parent_id").val(id);$("#content").attr('placeholder',name);$("#content").focus();$("html,body").animate({scrollTop:$(".all-comment-now-wrap").position().top},1000);}
function courseCommentNowNew(){var content=$.trim($("#content").val());if(content==""){alert("请填写讨论内容！");return false;}
if(ajaxCheckLoginPure()){$.ajax({async:false,url:"/home.php?m=Course&a=courseCommentNowNew",type:'post',data:{content:content,parent_id:$("#parent_id").val(),course_id:$("#id").val(),score:$(".score_font").text().replace("星","")},dataType:"text",success:function(data,text){try{var tmpJson=JSON.parse(data);if(!tmpJson.isValidate){alert(tmpJson.message);}}catch(e){$(data).prependTo(".all-comment-list-wrap");$("img.lazy").lazyload({effect:"fadeIn"});$("#content").val("");$("#content").attr('placeholder','');$("#parent_id").val('');$("html,body").animate({scrollTop:$(".all-comment-list-wrap").position().top-100},1000);}}});}else{showWin('.win-login-wrap');return;}}
function allCourseCommentsNew(e){$.ajax({async:false,url:"/home.php?m=Course&a=allCourseCommentsNew&id="+$("#id").val(),type:'post',dataType:"text",success:function(data,text){$(".all-comment-list-wrap").html(data);$("img.lazy").lazyload({effect:"fadeIn"});$(e).remove();$("html,body").animate({scrollTop:$(".all-comment-list-wrap").position().top-100},1000);}});}
function upCourseCommentNew(id,e){$.ajax({async:false,url:"/home.php?m=Course&a=upCourseCommentNew",type:'post',data:{id:id},dataType:"json",success:function(data,text){if(data.needLogin){showWin('.win-login-wrap');}
else{$(e).find("span").html(data.count);}}});}
function beforeLiveCourseReplyNew(id,name){$("#content").val("");$("#parent_id").val(id);$("#content").attr('placeholder',name);$("#content").focus();$("html,body").animate({scrollTop:$(".all-comment-now-wrap").position().top},1000);}
function liveCourseCommentNowNew(){var content=$.trim($("#content").val());if(content==""){alert("请填写讨论内容！");return false;}
if(ajaxCheckLoginPure()){$.ajax({async:false,url:"/home.php?m=Course&a=liveCourseCommentNowNew",type:'post',data:{content:content,parent_id:$("#parent_id").val(),live_course_id:$("#id").val(),score:$(".score_font").text().replace("星","")},dataType:"text",success:function(data,text){try{var tmpJson=JSON.parse(data);if(!tmpJson.isValidate){alert(tmpJson.message);}}catch(e){$(data).prependTo(".all-comment-list-wrap");$("img.lazy").lazyload({effect:"fadeIn"});$("#content").val("");$("#content").attr('placeholder','');$("#parent_id").val('');$("html,body").animate({scrollTop:$(".all-comment-list-wrap").position().top-100},1000);}}});}else{showWin('.win-login-wrap');return;}}
function allLiveCourseCommentsNew(e){$.ajax({async:false,url:"/home.php?m=Course&a=allLiveCourseCommentsNew&id="+$("#id").val(),type:'post',dataType:"text",success:function(data,text){$(".all-comment-list-wrap").html(data);$("img.lazy").lazyload({effect:"fadeIn"});$(e).remove();$("html,body").animate({scrollTop:$(".all-comment-list-wrap").position().top-100},1000);}});}
function upLiveCourseCommentNew(id,e){$.ajax({async:false,url:"/home.php?m=Course&a=upLiveCourseCommentNew",type:'post',data:{id:id},dataType:"json",success:function(data,text){if(data.needLogin){showWin('.win-login-wrap');}
else{$(e).find("span").html(data.count);}}});}
function checkOnline(){$.ajax({url:"/home.php?m=Course&a=checkOnline&id="+$("#id").val(),type:'post',dataType:"json",success:function(data,text){$(".on_line ul.list").html(data);}});}
function payHandel(){$(".type_btn a").eq(0).click(function(){$(this).addClass('active').siblings().removeClass('active').html("网银付款");});$("#types_open").click(function(){$("#types,#lock").show();$("#types img.selected").attr("src","./images/bank/"+$("#types img.selected").attr("data-type")+".png").removeClass('selected');});$("#lock").click(function(){$("#types,#lock").hide();});$("#types img").click(function(){$("#types,#lock").hide();$("#types_open").html('<i class="icons"></i>').append('<img src="'+this.src+'" alt="">').addClass('active').siblings().removeClass('active');});}
function livePlayLog(course_id,position,channelId){$.ajax({url:"/home.php?m=Course&a=livePlayLog&course_id="+course_id+"&position="+position+"&channel_id="+channelId,type:'get',success:function(data,text){}});}
function shipAlert(data_descript){$("#extend").html(data_descript).pop({title:"奖学金计划说明"});}
var ue=[];jQuery(document).ready(function(){var pager=$("#pager").length<=0?"":$("#pager").val();$("#nav_app").css("right",(($(window).width()-920)/2-208)+"px");if(jQuery(".win-wrap").length>0){$(".win-wrap").each(function(e){$(this).css("left",(($(window).width()-$(this).width())/2)+"px");$(this).css("top",(($(window).height()-$(this).height())/2)+"px");});}
if(jQuery('.u-editor').length>0){jQuery(".u-editor").each(function(){var tmpUe=UE.getEditor(jQuery(this).attr("name"),{imageScaleEnabled:false,initialFrameWidth:800});ue.push(tmpUe);});}
if(jQuery('.um-editor').length>0){if(pager=="worksAdd"){$(".um-editor").each(function(){var tmpUe=UM.getEditor($(this).attr("name"),{initialFrameHeight:500,toolbar:['fontfamily bold italic underline forecolor justifyleft justifycenter justifyright ']});ue.push(tmpUe);});}else{$(".um-editor").each(function(){var tmpUe=UM.getEditor($(this).attr("name"));ue.push(tmpUe);});}}
if($(".black-back").length>0){$(".black-back").click(function(){hideWin();});}
if(jQuery('.polyv-player-input').length>0){jQuery('.polyv-player-input').uploadify({'auto':true,'formData':{'fcharset':'ISO-8859-1','writetoken':getWriteToken(),'JSONRPC':JSON.stringify(getSubCoutseJSONRPC()),'cataid':getCourseCataId(),'sign':getPolyvSign()},'buttonText':'选择上传文件','fileSizeLimit':'2048MB','fileTypeDesc':'视频文件','fileTypeExts':'*.avi;*.f4v;*.mpg;*.mp4;*.flv;*.wmv;*.mov;*.3gp;*.rmvb;*.mkv;*.asf;*.264;*.ts;*.mts;*.dat;*.vob;*.mp3;*.wav;*.m4v;*.webm','swf':'./Public/uploadify/uploadify.swf','uploader':'http://v.polyv.net/uc/services/rest?method=uploadfile','onUploadSuccess':function(file,data,response){var jsonobj=eval('('+data+')');jQuery("#polyv_vid").val(jsonobj.data[0].vid);jQuery("#course_time").val(jsonobj.data[0].duration);var pager=$("#pager").val();if(pager=="sub_course_edit"){changePolyvVid();}else{if($.trim($("#course_name").val())==""){var name=jsonobj.data[0].title;if(name){name=name.substr(0,name.indexOf('.'));}
$("#course_name").val(name);}
initPolyvPlayer();}},'onUploadError':function(file,errorCode,errorMsg,errorString){alert('The file '+file.name+' could not be uploaded: '+errorString);}});}
if($(".course-fixed-menu-wrap").length>0){$(".course-fixed-menu-wrap").delegate(".fixed-menu-item","mouseover mouseout",function(e){if(!$(this).hasClass("current")){$(".course-fixed-menu-wrap .fixed-menu-item").removeClass("current");$(".course-fixed-menu-wrap .fixed-menu-item a").addClass("notshow");$(".course-fixed-menu-wrap .fixed-menu-item .image-path").each(function(){$(this).attr("src",$(this).attr("src").replace("_white.png","_grey.png"));});$(this).addClass("current");$(this).find("a").removeClass("notshow");$(this).find(".image-path").attr("src",$(this).find(".image-path").attr("src").replace("_grey.png","_white.png"));}else{$(this).removeClass("current");$(this).find("a").addClass("notshow");$(this).find(".image-path").attr("src",$(this).find(".image-path").attr("src").replace("_white.png","_grey.png"));}});}
function getFixedRight(){var baseW=1202;var rt=Math.max(20,(document.documentElement.clientWidth-baseW)/2-30);$(".go-to-top-btn").css({zIndex:"20",right:rt,left:"auto"})}
getFixedRight();$(window).resize(getFixedRight);$(window).bind("scroll",function(){if($(this).scrollTop()>$(window).height()){if(pager!="courseAllList"){$(".go-to-top-btn").removeClass("notshow");}}else{$(".go-to-top-btn").addClass("notshow");}});if($(".common-top-menu-wrap .search_block").length>0){$(".common-top-menu-wrap .search_block").click(function(e){e.stopPropagation();});$(".common-top-menu-wrap .search_block .icons").click(function(e){var parent=$(this).parent();if(parent.hasClass('search_active')){if(!/^\s*$/.test($(".common-top-menu-wrap .search_active input").val())){window.location="/?s="+$.trim($(".common-top-menu-wrap .search_active input").val());}else{alert("输入内容");}}else{$(this).parents().addClass("search_active")}})
$(document).click(function(){if(/^\s*$/.test($(".common-top-menu-wrap .search_active input").val())){$(".common-top-menu-wrap .search_active").removeClass("search_active")}});}
var winHeight=$(document).scrollTop();var menuOuterHeight=$('.common-top-menu-wrap').outerHeight();var scrollTimer;$(window).scroll(function(){if(scrollTimer){clearTimeout(scrollTimer);scrollTimer=undefined;}
scrollTimer=setTimeout(function(){var scrollY=$(document).scrollTop();if(scrollY>menuOuterHeight){$('.common-top-menu-wrap').addClass('hidden');}else{$('.common-top-menu-wrap').removeClass('hidden');}
if(scrollY>winHeight){$('.common-top-menu-wrap').removeClass('show');}else{$('.common-top-menu-wrap').addClass('show');}
winHeight=$(document).scrollTop();});if($(".new-course-fixed-menu-wrap").length>0){if($(this).scrollTop()>800){$(".new-course-fixed-menu-wrap").css("top",300+"px").css("position","fixed");}else{$(".new-course-fixed-menu-wrap").css("top",1140+"px").css("position","absolute");}}});$(".course-fixed-menu-wrap").css("left",(($(window).width()-915)/4)+"px");$(".course-fixed-menu-wrap").css("top",(($(window).height()-300)/2)+"px");$(".new-course-fixed-menu-wrap").css("right",(($(window).width()-1200)/4)+"px");$(".course-fixed-menu-wrap li").bind("mouseover mouseout",function(e){var src=$(this).find("img").attr("src");if(e.type=="mouseover"){$(this).find("img").attr("src",src.replace("_grey","_white"));$(this).find("span").show();$(this).css("background-color","#0E72AD");}else{$(this).find("img").attr("src",src.replace("_white","_grey"));$(this).find("span").hide();$(this).css("background-color","#F3F3F3");}});if(pager=="sub_course_edit"){initPolyvPlayer();}else if(pager=="live_course_details"||pager=="tele_course_details"){jQuery.ajax({url:'/home.php?m=Course&a=viewCount&id='+$("#id").val(),type:'post',success:function(data,text){}});$(".playing-wrap").css("left",(($(window).width()-915)/2)+"px");$(".playing-wrap").css("top",(($(window).height()-560)/2)+"px");$(".black-bg").click(function(){hideVedio();});if($("#pay_type").val()=="众筹"){var left=parseInt($("#time_left").val());if(left>0){setInterval(calcTime,100);}}
if(pager=="tele_course_details"){var sub_course_id=$.trim($("#sub_course_id").val());if(sub_course_id!=""){$(".sub-course"+sub_course_id).click();}}}else if(pager=="course_details"||pager=="open_course_details"||pager=="package_course-details"){jQuery.ajax({url:'/home.php?m=Course&a=courseViewCount&id='+$("#id").val(),type:'post',success:function(data,text){}});$(".playing-wrap").css("left",(($(window).width()-915)/2)+"px");$(".playing-wrap").css("top",(($(window).height()-560)/2)+"px");$(".black-bg").click(function(){hideVedio();});if(pager=="course_details"){var sub_course_id=$.trim($("#sub_course_id").val());if(sub_course_id!=""){$(".sub-course"+sub_course_id).click();}}}
else if(pager=="teacher_details"){$(".teacher-details-wrap .teacher-header .teacher-weixin").bind("click mouseover mouseout",function(e){if(e.type=="click"||e.type=="mouseover"){$(".teacher-details-wrap .teacher-header .teacher-weixin-image").show();}else if(e.type=="mouseout"){$(".teacher-details-wrap .teacher-header .teacher-weixin-image").hide();}});}else if(pager=="moreInfo"){$(".special-select-wrap").delegate(".current-select","click",function(){var $selectPanel=$(this).next(".select-panel");if($selectPanel.hasClass("notshow")){$selectPanel.removeClass("notshow");$(this).find(".select-status img").attr("src","./images/arrow_up.png");}else{$selectPanel.addClass("notshow");$(this).find(".select-status img").attr("src","./images/arrow_down.png");}});$(".special-select-wrap").delegate(".select-panel li","click",function(){var $select=$(this).parents(".special-select-wrap");var selectValue=$(this).attr("data-select-value")||$(this).text();var selectText=$(this).text();$select.find(".select-value").html(selectText);$select.find(".select-panel").addClass("notshow");$select.find(".select-status img").attr("src","./images/arrow_down.png");$select.find("input[type=hidden]").val(selectValue);});}else if(pager=="info"){$("#city-wrap").citySelect({prov:$("#provinceHdn").val(),city:$("#cityHdn").val(),dist:$("#districtHdn").val()});$('#portraitToBeChange').cropper({aspectRatio:16/16,preview:".portrait-preview",crop:function(e){$(".win-change-portrait-wrap #x").val(e.x);$(".win-change-portrait-wrap #y").val(e.y);$(".win-change-portrait-wrap #w").val(e.width);$(".win-change-portrait-wrap #h").val(e.height);}});}else if(pager=="publishWorksSucc"){var interval=setInterval(function(){var count=parseInt($('.count').html());if(count>0){count--;$(".count").html(count);}else{window.clearInterval(interval);window.location='/';}},1000);}else if(pager=="courseAllList"){$("body").css("background-color","#F6F6F6");$(".footer *").css("background-color","#F6F6F6");var width=$(window).width();var height=width*656/1900;$(".all-course-list-wrap .course-top-slide-wrap").width(width);$(".all-course-list-wrap .course-top-slide-wrap").height(height);$(".all-course-list-wrap .top-part").height(height+270);$(".all-course-list-wrap .course-top-slide-wrap .jcarousel img").width(width);$(".all-course-list-wrap .course-top-slide-wrap .jcarousel img").height(height);$(".all-course-list-wrap .course-top-slide-wrap .jcarousel li").height(height);var unslider=$('.course-top-slide-wrap .jcarousel').unslider({speed:500,delay:3000,complete:function(){},keys:true,dots:true,fluid:false});$(".course-top-slide-wrap .jcarousel ol.dots").css("left",(920-$(".course-top-slide-wrap .jcarousel ol.dots").width())/2+"px");$(".all-course-list-wrap .course-top-slide-wrap .jcarousel ol.dots").css("left",(width-$(".course-top-slide-wrap .jcarousel ol.dots").width())/2+"px");$(".course-top-slide-wrap .jcarousel ol.dots li:last").addClass("last");$('.course-top-slide-wrap .layer-slide-prev').click(function(){unslider.data('unslider')['prev']();});$('.course-top-slide-wrap .layer-slide-next').click(function(){unslider.data('unslider')['next']();});$('.cats-part-wrap .imenu').hover(function(){var it=$(this).attr('attr');$(this).stop().find('.submnu').animate({height:'show'},{queue:false,duration:500});$(this).stop().attr('class','imenu_on').siblings().attr('class','imenu');},function(){$(this).stop().find('.submnu').hide();$(this).stop().attr('class','imenu');});}else if(pager=="baseData"){}else if(pager=="collect"){$(".course_list .close_item").bind("click",function(){if(!confirm('确定此操作？')){return false;}
var id=$(this).attr("data-id");$current=$(this);$.ajax({url:"/home.php?m=Member&a=toggleCollectPost",type:"post",data:{id:id},success:function(data,text){$current.parents("li").remove();}})});}
else if(pager=="history"){$(".course_list .close_item").bind("click",function(){if(!confirm('确定此操作？')){return false;}
var id=$(this).attr("data-id");$current=$(this);$.ajax({url:"/home.php?m=Member&a=deletePostViewLog",type:"post",data:{id:id},success:function(data,text){$current.parents("li").remove();}})});}
else if(pager=="learn"){$(".course_list .close_item").bind("click",function(){if(!confirm('确定此操作？')){return false;}
var id=$(this).attr("data-id");$current=$(this);$.ajax({url:"/home.php?m=Member&a=deleteCoursePlayLog",type:"post",data:{id:id},success:function(data,text){$current.parents("li").remove();}})});}
else if(pager=="new_years_day"){$(".download-wrap a").click(function(){if($.cookie("is_clicked")==undefined){$.cookie("is_clicked","1");return true;}else{if($.cookie("is_shared5")==undefined){$('.weixin-share-notes-wrap').show();$.cookie("is_shared5","1");}else{return true;}}
return false;});$('.touch-slide-wrap').touchslide({timecontrol:3000,animatetime:300,direction:'left',navshow:false,canvassuport:false});$(".full-black-bg").click(function(){$(this).hide();$('.touch-slide-wrap').hide();});$(".touch-slide-wrap").click(function(){$(".full-black-bg").hide();$('.touch-slide-wrap').hide();});}else if(pager=="to_learn_param"){$(".download-wrap a").click(function(){if($.cookie("is_shared6")==undefined){$('.weixin-share-notes-wrap').show();setTimeout(function(){$.cookie("is_shared6","1");},10000);return false;}else{return true;}});$(".full-black-bg").click(function(){$(this).hide();$('.touch-slide-wrap').hide();});$(".touch-slide-wrap").click(function(){$(".full-black-bg").hide();$('.touch-slide-wrap').hide();});}
else if(pager.indexOf("category")>=0){var iImgClassIndex=0;var bScrollBtn=true;$(window).scroll(function(){var iTop=$(this).scrollTop();var iDocH=document.documentElement.clientHeight;var oTarget=$(".course_list");if(iTop+iDocH>=oTarget.offset().top+oTarget.outerHeight()&&bScrollBtn){bScrollBtn=false;$("#scroll_loading_bar").show();var url="/cat/"+pager.split('-')[1]+"?t=a&orderby="+$("#orderby").val();if($("#cname").length>0&&$("#cname").val()!=""){url="/cat/"+pager.split('-')[1]+"?t=a&cname="+$("#cname").val()+"&orderby="+$("#orderby").val();}
if(pager=="category-tag"){url="/tag/"+$("#tname").val();}
if($("#first").length>0&&$("#first").val()!=""){url=url+"&first="+$("#first").val();}
$.ajax({url:url,type:"get",data:{page:$("#page").val()},dataType:"html",success:function(data,text){$("#scroll_loading_bar").hide();$("#page").val(parseInt($("#page").val())+1);var ajaxItems=$(".cat-post-item",data);if(ajaxItems.length<=0){$("#scroll_loading_bar").css("background","none").show().html("下面没有了...");bScrollBtn=false;}else{bScrollBtn=true;ajaxItems.appendTo(".type_list ul");$("img.lazy",ajaxItems).lazyload({placeholder:"http://www.archcollege.com/images/lazy_default.jpg",effect:"fadeIn",threshold:100});}}});}});}
var controller=$("#controller").val();var action=$("#action").val();if(controller=="travel"){$(".big-inner-black-bg").height($(window).height());$(".travel-about-wrap").height($(window).height());$(".travel-rule-wrap").height($(window).height());if(action!="index"){$(".travel-content-wrap").fadeIn(2000);}else{$(".travel-content-wrap").show();}
$(".travel-about-btn").click(function(){if(!$(".big-inner-black-bg").is(":visible")){$(".big-inner-black-bg").fadeIn(800,function(){$(".travel-about-wrap").show().css("opacity",1).css("left",0);$(".travel-about-wrap").animate({"left":"310px"});});$(".travel-sider-wrap li").removeClass("selected");$(this).parents("li").addClass("selected");}else{$(".travel-rule-wrap").fadeOut();$(".big-inner-black-bg").fadeIn(800,function(){$(".travel-about-wrap").show().css("opacity",1).css("left",0);$(".travel-about-wrap").animate({"left":"310px"});});}});$(".big-inner-black-bg").click(function(){$(this).fadeOut(800);$(".travel-rule-wrap, .travel-about-wrap").fadeOut(800)})
$(".travel-rule-btn").click(function(){if(!$(".big-inner-black-bg").is(":visible")){$(".big-inner-black-bg").fadeIn(800,function(){$(".travel-rule-wrap").show();$(".travel-rule-wrap").animate({"left":"310px"});});$(".travel-sider-wrap li").removeClass("selected");$(this).parents("li").addClass("selected");}else{$(".travel-about-wrap").fadeOut();$(".big-inner-black-bg").fadeIn(800,function(){$(".travel-rule-wrap").show();$(".travel-rule-wrap").animate({"left":"310px"});});}});$(".big-inner-black-bg").click(function(){$(".travel-rule-wrap").fadeOut(400);$(".travel-about-wrap").fadeOut(400);$(this).fadeOut(400);});if($('.travel-sider-wrap .selected').get(0))
$('.dynamic-efficiency').css('top',$('.travel-sider-wrap .selected').position().top);$('.dynamic-efficiency').show();$('.travel-sider-wrap .selected a').css('color','#fff');$('.travel-sider-wrap li').mouseenter(function(){$('.travel-sider-wrap li').find('a').css('color','');$(this).find('a').css('color','#fff');$('.dynamic-efficiency').css('top',$(this).position().top);if(!$(this).hasClass("selected")){$('.travel-sider-wrap .selected a').css('color','#616161');}});$('.travel-sider-wrap').mouseleave(function(){$('.dynamic-efficiency').css('top',$('.travel-sider-wrap .selected').position().top);$('.travel-sider-wrap li').find('a').css('color','');$('.travel-sider-wrap .selected a').css('color','#fff');});$('.travel-sider-wrap .selected').trigger('mouseover');if(action=="index"){$("#layerslider").height($(window).height());$('#layerslider').layerSlider({autoStart:true,showCircleTimer:false,loops:0,navButtons:false,navPrevNext:false,navStartStop:false,thumbnailNavigation:'disabled',autoPauseSlideshow:false});$("#layerslider").height($(window).height()-100);$("#layerslider .travel-cover-inner").width($(window).width()-728-50).height($(window).height()-100);$(window).resize(function(e){$("#layerslider .travel-cover-inner").width($(window).width()-728-50).height($(window).height()-100);$("#layerslider").height($(window).height()-100);});}else if(action=="route"){var hoverT;$(".travel-route-list li .travel-image-wrap").bind("mouseenter mouseleave",function(e){if(e.type=="mouseenter"){$(this).find(".black-bg-btn").fadeIn(400);}else{$(this).find(".black-bg-btn").fadeOut(400);}});$(".travel-route-list li .travel-image-wrap").width($(window).width()-732-50);$(window).resize(function(e){$(".travel-route-list li .travel-image-wrap").width($(window).width()-732-50);});}else if(action=="review"){}else if(action=="service"){$(".travel-service-wrap li").height($(window).height()-100);var oldIndex=4;var slideBtn=true;$(".travel-service-wrap .service-item").mousemove(function(event){var curIndex=$(this).attr("data-next");if(!slideBtn||curIndex==oldIndex)return;slideBtn=false;$(".service-item-info-"+oldIndex).toggle(600);$(".service-item-info-"+curIndex).find("div").hide().parent().toggle(600,function(){$(this).find("div").fadeIn(300);slideBtn=true;$(".travel-service-wrap .service-item").trigger('mouseenter');});oldIndex=curIndex;});}else if(action=="enroll"){var isForeign=$("#isForeign").val();if(isForeign=='outside'){var isForeign=true;}else{var isForeign=false;};if(isForeign)
$("#add_item").height(239);function listEmpty(){$(".user_form ").show();$(".user_form .close").hide();$("#add_item").hide();}
function computePrice(){var len=$(".user_list li").length;var price=$("#one_price").val();$("#total_price").html(price*len);$("#half_price").html(price*len/2);$("#list_num").html(len);}
computePrice();var changeLi;if($(".user_list li").length==0){listEmpty();}else{$("#add_item").show();}
$("#add_item").click(function(){$("#verifyImg").attr("src",$("#verifyImg").attr("src"));$(".user_form").show();changeLi=undefined;if($("#user_fm").get(0))$("#user_fm").get(0).reset();});$(".user_form .close").click(function(){$(".user_form").hide();});$(document).on("click",".user_list li .del",function(){if(confirm("确定此操作？")){var parent=$(this).parents("li");dateId=parent.attr("id");$.ajax({url:'home.php/Travel/DelCookie',type:'get',dataType:'json',data:{id:dateId},success:function(data){}});if(changeLi&&changeLi[0]==parent[0])changeLi=undefined;parent.remove();listEmpty();computePrice();}});var noHz;$(document).on("click",".user_list li .change",function(){$("#verifyImg").attr("src",$("#verifyImg").attr("src"));var aInput=$(".user_info .tText");var parent=$(this).parents("li");dateId=parent.attr("id");$(isForeign?[".tName",".tSex",".tCodeId",".tPhone",".tQQ",".tPassport"]:[".tName",".tSex",".tCodeId",".tPhone",".tQQ"]).each(function(index,str){if($(str,parent).html()=="未填")
aInput.filter(str).val("");else
aInput.filter(str).val($(str,parent).html());});$(".user_form").show();changeLi=parent;});$("#noHz").change(function(){if(this.checked){$(".hide_hz").hide().filter("input").val("");}else{$(".hide_hz").show();}})
$(".user_info .ok").click(function(){var aInput=$(".user_info .tText");var empty=/^\s*$/;var phone=/^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|17[0-9]{9}$|18[0-9]{9}$/;var QQ=/\d{6,20}/;var regIdCard=/^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/;var hz=/^\w+$/;var date=/^\d{4}\-\d{1,2}\-\d{1,2}$/;if($("#noHz").get(0))
noHz=$("#noHz").get(0).checked;if(empty.test(aInput.filter(".tName").val())){alert('姓名不能为空');}else if(empty.test(aInput.filter(".tQQ").val())){alert("QQ不能为空");}else if(!QQ.test(aInput.filter(".tQQ").val())){alert("QQ格式错误");}else if(empty.test(aInput.filter(".tPhone").val())){alert("手机不能为空");}else if(!phone.test(aInput.filter(".tPhone").val())){alert("手机号码错误");}else if(empty.test(aInput.filter(".tCodeId").val())){alert("身份证不能为空");}else if(!regIdCard.test(aInput.filter(".tCodeId").val())){alert("身份证格式错误");}else if(isForeign&&!noHz&&empty.test(aInput.filter(".tPassport").val())){alert("护照不能为空");}else if(isForeign&&!noHz&&!hz.test(aInput.filter(".tPassport").val())){alert("护照格式错误");}else if(!/^\w{4,6}$/.test(aInput.filter(".tCheckCode").val())){alert("验证码错误");}else{var isReturn=false;$(".user_list li").each(function(){if(changeLi&&changeLi.get(0)==this)return true;if(aInput.filter(".tPhone").val()==$(".tPhone",this).html()){alert("该手机号码已存在");isReturn=true;return false;}})
if(isReturn)return;var verifyId=$(".tCheckCode").val();$.ajax({url:'home.php/Travel/verifyConfirm',type:'get',dataType:'json',data:{id:verifyId},success:function(data){if(data.flag){checkSuccess(aInput);}else{alert(data.error);}}});}});var dateId;function checkSuccess(aInput){var sInner=['        		<div class="clear name_sex">','        		    <span class="fl tName">'+aInput.filter(".tName").val()+'</span>','        		    <em class="fr tSex">'+aInput.filter(".tSex").val()+'</em>','        		</div>','               <p><span>身份证</span><em class="tCodeId">'+aInput.filter(".tCodeId").val()+'</em></p>',isForeign?'<p><span>护照</span><em class="tPassport">'+(noHz?"未填":aInput.filter(".tPassport").val())+'</em></p>':"",'        		<p><span>手机号</span><em class="tPhone">'+aInput.filter(".tPhone").val()+'</em></p>','        		<p><span>QQ号</span><em class="tQQ">'+aInput.filter(".tQQ").val()+'</em></p>','        		<div class="btn_bar">','            		<a href="javascript:void(0)" class="change">编辑</a>','            		<a href="javascript:void(0)" class="del">删除</a>','        		</div>'].join("");var tName=aInput.filter(".tName").val();var tQQ=aInput.filter(".tQQ").val();var tSex=aInput.filter(".tSex").val();var tPhone=aInput.filter(".tPhone").val();var tCodeId=aInput.filter(".tCodeId").val();var tPassport=aInput.filter(".tPassport").val();if(!changeLi){dateId=new Date().getTime();}
$.ajax({url:'home.php/Travel/travelCookie',type:'get',dataType:'json',data:{tName:tName,tQQ:tQQ,tSex:tSex,tPhone:tPhone,tCodeId:tCodeId,tPassport:tPassport,id:dateId},success:function(data){}});if(changeLi){changeLi.html(sInner);}else{$(".user_list ul").append('<li class="item" id="'+dateId+'">'+sInner+'</li>');}
$(".user_form").hide().find(".close").show();$("#add_item").show();if($("#user_fm").get(0)){$("#user_fm").get(0).reset();}
if($("#noHz").get(0))$("#noHz").get(0).checked=noHz;computePrice();}
$(".item_select li").click(function(){$(this).addClass('active').siblings().removeClass('active');var val=$(this).attr("value");$(".timeInput").val(val);});payHandel();$("#sub_enroll").click(function(){if($(".user_list li").length==0){alert("尚未填写报名信息,请先填写");self.location.reload();}})}}else if(controller=="down"){if(action=="index"){var width=$(window).width();var height=$(window).height();$(".app-down-page-wrap .section").height(height);$(".black-bg").width(width).height(height);$(".app-down-qrcode").css("left",((width-271)/2)+"px").css("top",((height-359)/2)+"px");if($('.app-down-page-wrap')[0])
$('.app-down-page-wrap').fullpage({sectionsColor:['#ffffff','#ffffff'],anchors:['page1','page2'],menu:'.app-donw-menu',afterLoad:function(anchorLink,index){if(index==2){$(".app-donw-menu").addClass("page2");$(".left-part").animate({"margin-left":"106px","opacity":1},1000);$(".contact-wrap").animate({"margin-left":"106px","opacity":1},2000);$(".top-part").animate({"margin-top":"-200px","opacity":0},1000);$(".bottom-part").animate({"margin-top":"400px","opacity":0},1000);}else{$(".app-donw-menu").removeClass("page2");$(".top-part").animate({"margin-top":"0px","opacity":1},1000);$(".bottom-part").animate({"margin-top":"100px","opacity":1},1000);$(".left-part").animate({"margin-left":"-200px","opacity":0},1000);$(".contact-wrap").animate({"margin-left":"-200px","opacity":0},1500);}}});$(".top-part").animate({"margin-top":"0px","opacity":1},1000);$(".bottom-part").animate({"margin-top":"100px","opacity":1},1000);$(".down-ios-btn").click(function(){if($(".app-down-qrcode.ios").is(":visible")){$(".app-down-qrcode.ios").fadeOut();$(".black-bg").fadeOut();}else{$(".app-down-qrcode.ios").fadeIn();$(".black-bg").fadeIn();}});$(".down-android-btn").click(function(){if($(".app-down-qrcode.android").is(":visible")){$(".app-down-qrcode.android").fadeOut();$(".black-bg").fadeOut();}else{$(".app-down-qrcode.android").fadeIn();$(".black-bg").fadeIn();}});$(".black-bg").click(function(){$(".app-down-qrcode").fadeOut();$(".black-bg").fadeOut();});$(".customer-qrcode-btn").click(function(){if($(".customer-qrcode").is(":visible")){$(".customer-qrcode").fadeOut();}else{$(".customer-qrcode").fadeIn();}});}}else if(controller=="hot"){if(action=="zhaha"){$(".common-top-menu-wrap").remove();$(".go-to-top-btn").remove();$(".text-wrap").each(function(){$(this).find("div").height($(this).height());});}}else if(controller=="teacher"){if(action=="unit_apply_progress2"||action=="outfit_apply_progress2"){if(action=="unit_apply_progress2"){progress2.unit();}else{progress2.outfit();}
if($("#id_card_image_path").val()!=""){upDone(0,$("#id_card_image_path").val());}
if($("#image_path").val()!=""){upDone(1,$("#image_path").val());}
if($("#licence_image_path").val()!=""){upDone(2,$("#licence_image_path").val());}
$(".btn-submit").bind("click",function(){var datas=[];$(".teacher-education-list li").each(function(){var item1=$(this).find("input[type=text]").eq(0);var item2=$(this).find("input[type=text]").eq(1);var item3=$(this).find("input[type=text]").eq(2);if($.trim(item1.val())!=""&&$.trim(item2.val())!=""&&$.trim(item3.val())!=""){datas.push({start_time:$.trim(item1.val()),end_time:$.trim(item2.val()),content:$.trim(item3.val())});}});$("#teacher_education_list").val(JSON.stringify(datas));var datas=[];$(".teacher-experience-list li").each(function(){var item1=$(this).find("input[type=text]").eq(0);var item2=$(this).find("input[type=text]").eq(1);var item3=$(this).find("input[type=text]").eq(2);if($.trim(item1.val())!=""&&$.trim(item2.val())!=""&&$.trim(item3.val())!=""){datas.push({start_time:$.trim(item1.val()),end_time:$.trim(item2.val()),content:$.trim(item3.val())});}});$("#teacher_experience_list").val(JSON.stringify(datas));});$(".check_phone_dialog .confirm").bind("click",function(){if($.trim($(".check_phone_dialog input[type=text]").val())==""){alert("请输入短信验证码！");return false;}
$.ajax({url:"/home.php?m=Teacher&a=checkSmsVerifyCode",type:"post",data:{mobile:$.trim($(".unit-apply-progress2-wrap #mobile").val()),verifyCode:$.trim($(".check_phone_dialog input[type=text]").val())},success:function(data,text){alert(data.message);isCheckPhone=data.isValidate;if(isCheckPhone){$('.check_phone_dialog').pop().close();}}});});}else if(action=="index_manage_1"){if($("#banner_image_path").val()!=""){imageUpDone('#upimg_banner',$("#banner_image_path").val());}}else if(action=="index_manage_2"){$("#sbt_teacher_works").bind("click",function(){var items=[];var index=1;$(".add_std_works tr.work-item").each(function(){items.push({id:$(this).find(".upimg2").attr("id"),image_path:$(this).find("img").attr("src"),name:$(this).find("input[type=text]").val(),type:$(this).find("dd.active").text(),show_order:index++});});$("#items").val(JSON.stringify(items));});$(".work-item .upimg2").each(function(){if($(this).find("img").attr('src')!=""){imageUpDone('#'+$(this).attr("id"),$(this).find("img").attr('src'));}});}else if(action=="index_manage_3_1"){$(".search_block i").bind("click",function(){var keyword=$.trim($('#keyword').val());if(keyword==""){alert("请填写关键词！");return false;}
window.location='/home.php?m=Teacher&a=index_manage_3_1&keyword='+keyword+"&t="+$(".checkbox_active").attr("data-id");});}else if(action=="index_manage_4"){$(".search_block i").bind("click",function(){var keyword=$.trim($('#keyword').val());if(keyword==""){alert("请填写关键词！");return false;}
window.location='/home.php?m=Teacher&a=index_manage_4&keyword='+keyword+"&t="+$("#type").val();});}else if(action=="index_manage_5"){var cataid=getTeacherCataId();$("#up_video").click(function(){$("#open_upvideo").pop({title:"视频上传",noHide:true});})
$('#file_upload_1').uploadify({'auto':true,'queueID':'file_upload_1-queue','buttonText':'选择上传文件','fileSizeLimit':'3000MB','fileTypeDesc':'视频文件','fileTypeExts':'*.avi; *.wmv; *.mp4;*.mp3; *.mov; *.flv; *.mkv; *.rmvb','swf':'/Public/uploadify/uploadify.swf','multi':true,'queueSizeLimit':100,'uploader':'http://v.polyv.net/uc/services/rest?method=uploadfile',removeCompleted:false,progressData:"speed",onUploadStart:function(file){var name=file.name.substring(0,file.name.lastIndexOf(file.type));var sign=getPolyvSign2(cataid,name);$('#file_upload_1').uploadify('settings','formData',{'fcharset':'ISO-8859-1','writetoken':"aRTUQVx1Cikcpxq-oPcz40u14LHwd1zf",'cataid':cataid,'sign':sign,'JSONRPC':'{"title":"'+name+'","tag":"","desc":"无"}'})}});function getPolyvSign2(cataid,title){var sign="";$.ajax({url:"admin.php?m=Public&a=getPolyvSign",type:"POST",async:false,data:{title:title,tag:"",desc:"无",cataid:cataid},success:function(data,text){sign=data;}});return sign;}
$(".video_list").delegate("input[type=text]","blur",function(e){var $current=$(this);if($.trim($current.val())==""){return false;}
$.ajax({url:"/home.php?m=Teacher&a=ajaxVedioCat",type:"post",data:{id:$current.attr("data-cid"),name:$.trim($current.val())},success:function(data,text){if(data.status==-1){showWin(".win-login-wrap");}else if(data.status=1){$current.attr("data-cid",data.id);}}});});$(".search_block i").bind("click",function(){var keyword=$.trim($('#keyword').val());if(keyword==""){alert("请填写关键词！");return false;}
window.location='/home.php?m=Teacher&a=index_manage_5&keyword='+keyword;});}else if(action=="add_course_1"){if($.trim($("#image_path").val())!=""){imageUpDone('.upfile_form',$.trim($("#image_path").val()));}}else if(action=="add_course_3"){$(".add_course_main").delegate(".tCourse_name","blur",function(e){var $current=$(this);if($.trim($current.val())==""){return false;}
$.ajax({url:"/home.php?m=Teacher&a=ajaxChapter",type:"post",data:{id:$current.attr("data-id"),name:$.trim($current.val()),course_id:$("#course_id").val(),type:$("#course_type").val()},success:function(data,text){if(data.status==-1){showWin(".win-login-wrap");}else if(data.status=1){$current.attr("data-id",data.id);}}});});}}else if(controller=="course"){if(action=="telecoursedetails"){var need_login=$("#need_login").val();if(need_login=='true'){showWin('.win-login-wrap');return false;}else{polyvObject("#player").createRoom({'channelId':$('#channelId').val(),'userId':$("#live_member_id").val(),'userName':$("#live_member_name").val(),'pic':$("#live_member_avator").val(),'hash':$("#hash").val(),'showPlayer':'yes'});}}else if(action=="telecourseplayback"){playback($("#id").val());}}else if(controller=="member"){$('.member_burse_btn').click(function(){$(".member_burse_pop").pop({title:"奖学金纪录"});})
if(action=="travelorder"){function openPayPop(pay_id){var id=pay_id;$("#pay_dtls").next().remove();$("#append").html("");$.ajax({url:"home.php?m=Member&a=pay_order",type:"post",dataType:"json",data:{pay_id:id},success:function(data){var sHtml="";sHtml+='<tr>'
+'<td>'+data.name+'</td>'
+'<td>X <span id="list_num">'+data.personnum+'</span>'
+'</td>'
+'<td><span id="total_price">'+parseFloat(data.price)*data.personnum+'</span>元</td>'
+'<td class="price">￥<span id="half_price">'+parseFloat(data.price)*data.personnum/2+'</span></td>'
+'</tr>';$("#pay_dtls").after(sHtml);var tHtml="";if(data.pre_payment==0){tHtml=['								<p class="pay_surplus_info" style="display:block">','								<span class="s2">','				    			支付定金 <em>￥'+parseFloat(data.price)*data.personnum/2+'</em>','								</span>','								<br>','								<span class="s1">','								完成出行合同签订后再交付剩余费用','								</span>','								</p>'].join("");}else{tHtml=['								<p class="pay_earnest_info" style="display:block">','								<span class="s1">已付定金￥'+parseFloat(data.price)*data.personnum/2+'</span>','								<br>','								<span class="s2">','								支付余款 <em>￥'+parseFloat(data.price)*data.personnum/2+'</em>','								</span>','								</p>'].join("");}
$("#append").append(tHtml);}});$("#travel_order_pay_pop").pop({end:function(){$(".pay_surplus_info,.pay_earnest_info").hide();$("#types").hide();$(".type_btn a").eq(0).trigger('click');}});$("#travel_order_pay_pop").find("img").each(function(index,el){if(!el.src)
el.src=$(el).attr("data-src");});}
function openPayResult(){var order_id=curId;var post_tupe=$("#pay_type").val();var bank=$("#bank").val();$.ajax({url:"home.php?m=Member&a=travel_pay",type:"post",dataType:"json",data:{order_id:order_id,post_tupe:post_tupe,bank:bank},success:function(data){$("#pay_result").append(data);}});}
function openApplayBack(pay_id){var id=pay_id;$("#details").html("");$.ajax({url:"home.php?m=Member&a=refundmoney",type:"post",dataType:"json",data:{pay_id:id},success:function(data){if(data.pre_payment=='1'&&data.all_status=='0'){$("#applay_back .price").html(parseFloat(data.price)*data.personnum/2+"元");}else if(data.pre_payment=='1'&&data.all_status=='1'){$("#applay_back .price").html(parseFloat(data.price)*data.personnum+"元");}
var sHtml="";sHtml=['							<a href="" class="img"><img src="'+data.image_path+'" alt=""></a>','							<div class="text">','							<a href="">'+data.name+'</a>','							<p>总价：￥'+parseFloat(data.price)+'</p>','							<p>出游时间：'+data.start_date+' ~ '+data.end_date+'</p>','							<input type="hidden" id="out_trade_no" value="'+data.order_id+'">','							</div>'].join("");$("#details").append(sHtml);}});$("#applay_back").find("form").get(0).reset();$("#applay_back").pop();}
function openApplayBackResult(reason,remarks,out_trade_no){var reason=reason;var remarks=remarks;var out_trade_no=out_trade_no;$.ajax({url:"home.php?m=Member&a=refundaction",type:"post",dataType:"json",data:{reason:reason,remarks:remarks,out_trade_no:out_trade_no},success:function(data){if(data=="退款成功"){var sHtml="";sHtml=['							<h3>申请退款成功!</h3>','							<p>退款金额会在3~10个工作日内退回您的支付账户。</p>','							<a href="http://wpa.qq.com/msgrd?v=3&uin=53963608&site=qq&menu=yes">联系在线客服</a>'].join("");$("#applay_back_result").append(sHtml);$("#applay_back_result").pop({end:function(){window.location.reload();}});}else{var sHtml="";sHtml=['							<h3>申请退款失败!</h3>','							<p>如有问题，请联系客户</p>','							<a href="http://wpa.qq.com/msgrd?v=3&uin=53963608&site=qq&menu=yes">联系在线客服</a>'].join("");$("#applay_back_result").append(sHtml);$("#applay_back_result").pop({end:function(){window.location.reload();}});};}});}
var curId='';$(".pay_surplus").click(function(){var pay_id=$(this).attr("data-pay_id");curId=pay_id;openPayPop(pay_id);$(".pay_earnest_info").show();$(".pay_surplus_info").hide();})
$(".pay_earnest").click(function(){var pay_id=$(this).attr("data-pay_id");curId=pay_id;openPayPop(pay_id);$(".pay_earnest_info").hide();$(".pay_surplus_info").show();})
$(".type_btn a").eq(0).click(function(){$(this).addClass('active').siblings().removeClass('active').html("网银付款");});$("#types_open").click(function(){$("#types").show();});$("#types img").click(function(){$("#types,#lock").hide();$("#types_open").html('<i class="icons"></i>').append('<img src="'+this.src+'" alt="">').addClass('active').siblings().removeClass('active');});$("#sub_enroll").click(openPayResult);$(".apply_refund").click(function(){var pay_id=$(this).attr("data-pay_id");openApplayBack(pay_id);});$(".close_refund").click(function(){var pay_id=$(this).attr("data-pay_id");alert(pay_id)
openApplayRevoke(pay_id);})
$("#applay_back .public_btn_bg").click(function(){var reason=$("#reason").val();var remarks=$("#remarks").val();var out_trade_no=$("#out_trade_no").val();if($("#applay_back select").get(0).selectedIndex==0){alert("请选择退款原因");}else{openApplayBackResult(reason,remarks,out_trade_no);}})}else if(action=="bystagesorder"){$(".type_btn a").eq(0).click(function(){$(this).addClass('active').siblings().removeClass('active').html("网银付款");$(".check_huabei,.huabei_type").show();$("#isByStages")[0].checked=false;$(".huabei_type").removeClass('huabei_type_active');});$("#isByStages").change(function(event){if(this.checked){$(".huabei_type").addClass('huabei_type_active');}else{$(".huabei_type").removeClass('huabei_type_active');}});$("#types_open").click(function(){$("#lock,#types").show();});$("#lock").click(function(){$("#types,#lock").hide();});$("#types img").click(function(){$("#types,#lock").hide();$("#types_open").html('<i class="icons"></i>').append('<img src="'+this.src+'" alt="">').addClass('active').siblings().removeClass('active');$(".check_huabei,.huabei_type").hide();});$(".huabei_type li").click(function(){if(!$(this).parent().hasClass("huabei_type_active")){return;}
$(this).addClass('active').siblings().removeClass("active");})
$("#sub_enroll").click(function(){var empty=/^\s*$/;var phone=/^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|17[0-9]{9}$|18[0-9]{9}$/;var QQ=/\d{6,20}/;if(empty.test($(".tPhone").val())){alert("手机不能为空");}else if(!phone.test($(".tPhone").val())){alert("手机号码错误");}else if(empty.test($(".tQQ").val())){alert("QQ不能为空");}else if(!QQ.test($(".tQQ").val())){alert("QQ格式错误");}else{}})}}else if(controller=="order"){if(action=="subcourseconfirm"||action=="confirm"||action=="courseconfirm"||action=="viporder"){var countdown=60;function settime(obj){if(countdown==0){obj.removeAttribute("disabled");obj.value="点击获取";countdown=60;return;}else{obj.setAttribute("disabled",true);obj.value="重新发送("+countdown+")";countdown--;}
setTimeout(function(){settime(obj)},1000)}
$('.tPhone').on("input",function(event){if(this.value==$("#iphone_original").val()&&!/^\s*$/.test(this.value)){$("#check_bar").hide();}else{$("#check_bar").show();}});$("#send_btn").click(function(){var sPhone=$(".tPhone").val();var rpPhone=/^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|17[0-9]{9}$|18[0-9]{9}$/;if(rpPhone.test(sPhone)){var mobile=$("#pay_mobile").val();var type='payMessage';$.ajax({url:"/home.php?m=Member&a=sendSmsVerifyCode&mobile="+mobile+"&type="+type,type:"post",success:function(data,text){dataInJson=eval('('+data+')');if(dataInJson.errno=="000"){alert("发送成功，请注意查收！");setTiem();}else{alert(dataInJson.errmsg);}}});settime(this);}else{alert("请输入正确的手机号");}})
$("#action_virtual").change(function(){if(this.checked){$(".result").show();$("#useSchop").val(1)
$("#total_num").text(parseInt($("#_price").val())-parseInt($("#_virtual_money").val()));}else{$(".result").hide();$("#useSchop").val(0)
$("#total_num").text(parseInt($("#_price").val()));}})
payHandel();$("#sub_enroll").click(function(){var sPhone=$(".tPhone").val();var sQQ=$(".tQQ").val();var rpPhone=/^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|17[0-9]{9}$|18[0-9]{9}$/;var rpQQ=/^[0-9]{6,20}$/;if(!rpPhone.test(sPhone)){alert("请输入正确的手机号");return false;}else if(!rpQQ.test(sQQ)){alert("请输入正确的QQ号");return false;}else if(!/^\w{4,6}$/.test($(".tCheck").val())&&$("#check_bar").css("display")!="none"){alert("请输入短信验证码");return false;}
return true;})}}
$(".buy").click(function(){var closing_date=$("#closing_date").val();if(closing_date==1){alert('该课程已停止购买，具体详情请联系客服！');return false;}
return true;})});$('.mm').each(function(){if($($(this))[0].href==String("home.php?m=Article&a=hotPost&flag=month"))
$(this).addClass('select').siblings().removeClass('select');if($($(this))[0].href==String("home.php?m=Article&a=hotPost&flag=week"))
$(this).addClass('select').siblings().removeClass('select');if($($(this))[0].href==String("home.php?m=Article&a=hotPost&flag=all"))
$(this).addClass('select').siblings().removeClass('select');});function agreeTiaokuan(){$.ajax({url:"/home.php?m=Course&a=noticeConfirm",type:"get",success:function(data){dataInJson=eval('('+data+')');if(dataInJson.errno=="000"){}else{alert(dataInJson.errmsg);}}});}